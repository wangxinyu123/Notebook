# å¤šé¡µé¢åº”ç”¨æ‰“åŒ…

æ—¥å¸¸å·¥ä½œä¸­å¤§éƒ¨åˆ†åœºæ™¯ä¸‹æˆ‘ä»¬éƒ½æ˜¯åœ¨ä½¿ç”¨`webpack`æ„å»ºä¼ ç»Ÿå•é¡µé¢`spa`åº”ç”¨ã€‚

æ‰€è°“çš„å•é¡µé¢åº”ç”¨ä¹Ÿå°±æ˜¯è¯´æ‰“åŒ…åçš„ä»£ç ä»…ä»…ç”Ÿæˆä¸€ä»½`html`æ–‡ä»¶ï¼ŒåŸºäºå‰ç«¯è·¯ç”±`js`å»æ§åˆ¶æ¸²æŸ“ä¸åŒçš„é¡µé¢ã€‚

å½“ç„¶æ‰€è°“çš„å¤šé¡µé¢åº”ç”¨ç®€å•æ¥è¯´ä¹Ÿå°±æ˜¯æ‰“åŒ…åç”Ÿæˆå¤šä¸ª`html`æ–‡ä»¶ã€‚

è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ¥é‡ç‚¹ä»‹ç»å¤šé¡µé¢åº”ç”¨ï¼Œæ–‡ç« ä¸­æ¶‰åŠçš„å†…å®¹çº¯å¹²è´§ã€‚æˆ‘ä»¬åºŸè¯ä¸å¤šè¯´ï¼Œä¸€ç¯‡æ–‡ç« è®©ä½ å½»åº•ææ‡‚æ‰€è°“å·¥ç¨‹åŒ–çš„å¤šé¡µé¢åº”ç”¨æ„å»ºã€‚

æ–‡ç« ä¸­æ¶‰åŠçš„æ¨¡æ¿é…ç½®å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹[æˆ³è¿™é‡ŒğŸ‘‡](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F19Qingfeng%2Fpages)ã€‚

**ä¸è¦å¿˜è®°ç»™ä¸€ä¸ª`star`å‘€å¤§ä½¬ä»¬(ç¥ˆæ±‚è„¸.jpg)**

å‰è¾¹éƒ¨åˆ†æ˜¯åŸºäºåŸºç¡€é…ç½®ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ª`React+TypeScript+Webpack`çš„è®²è§£éƒ¨åˆ†ï¼Œå¦‚æœè¿™å—ä½ å·²ç»è¶³å¤Ÿäº†è§£äº†ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° **[åˆ‡å…¥å¤šé¡µé¢åº”ç”¨](https://juejin.cn/post/7011128931533193230/#heading-39)** å»æŸ¥çœ‹åŠ¨æ€å¤šé¡µé¢éƒ¨åˆ†çš„é…ç½®ã€‚

æœ€ç»ˆæˆ‘ä»¬è¾¾åˆ°çš„æ•ˆæœå¦‚ä¸‹ğŸ‘‡:

![1632404783258.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc9035312624498280c6f018f9bbe623~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

åŸè°…æˆ‘å®åœ¨æ˜¯ä¸ä¼š`gif...`

## åˆå§‹åŒ–ç›®å½•ç»“æ„

è®©æˆ‘ä»¬æ¥å…ˆåˆå§‹åŒ–æœ€åŸºç¡€çš„å·¥ç¨‹ç›®å½•ï¼š

[github.com/19Qingfeng/â€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F19Qingfeng%2Fpages.git)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6a0cf9b8ef94f6ea2f90076b7751b86~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è®©æˆ‘ä»¬å…ˆæ¥å®‰è£…`webpack`ä»¥åŠ`React`:

```
yarn add -D webpack webpack-cli
yarn add react react-dom
```

> `webpack-cli`æ˜¯`webpack`çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨`webpack`ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬å»åˆ†åˆ«åˆ›å»ºä¸åŒçš„é¡µé¢ç›®å½•ï¼Œå‡è®¾æˆ‘ä»¬å­˜åœ¨ä¸¤ä¸ªå¤šé¡µé¢åº”ç”¨ã€‚

ä¸€ä¸ª`editor`ç¼–è¾‘å™¨é¡µé¢ï¼Œä¸€ä¸ª`home`ä¸»é¡µã€‚

å®‰è£…å®Œæˆä¹‹åè®©æˆ‘æ¥æ”¹å˜æ”¹å˜ç›®å½•æ–‡ä»¶:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c03d9ecb79274ab0b389657c8dbb0577~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

åˆ›å»ºçš„é¡¹ç›®é…ç½®å¦‚ä¸‹ï¼Œæˆ‘ä»¬åˆ†åˆ«å…ˆæ¥è®²è®²è¿™ä¸¤ä¸ªåŸºç¡€æ–‡ä»¶å¤¹

- `containers`æ–‡ä»¶å¤¹ä¸­å­˜æ”¾ä¸åŒé¡¹ç›®ä¸­çš„ä¸šåŠ¡é€»è¾‘
- `packages`æ–‡ä»¶å¤¹ä¸­å­˜æ”¾ä¸åŒé¡¹ç›®ä¸­çš„å…¥å£æ–‡ä»¶

> è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹æˆ‘ä»¬å…ˆä¸å…³å¿ƒï¼Œä»…å»ºç«‹å¥½æœ€åŸºç¡€çš„æ–‡ä»¶ç›®å½•ã€‚

## é…ç½®`react`æ”¯æŒ

æ¥ä¸‹æ¥è®©æˆ‘ä»¬çš„é¡¹ç›®å…ˆæ”¯æŒæœ€åŸå§‹çš„`jsx`æ–‡ä»¶ï¼Œè®©é¡¹ç›®æ”¯æŒ`react`çš„`jsx`ã€‚

æ”¯æŒ`jsx`éœ€è¦é¢å¤–é…ç½®`babel`å»å¤„ç†`jsx`æ–‡ä»¶ï¼Œå°†`jsx`è½¬è¯‘æˆä¸ºæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„`js`ã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°å¦‚ä¸‹å‡ ä¸ªåº“:

- `babel-loader`
- `@babel/core`
- `@babel/preset-env`
- `@babel/plugin-transform-runtime`
- `@babel/preset-react`

æˆ‘ä»¬æ¥ç¨å¾®æ¢³ç†ä¸€ä¸‹è¿™å‡ ä¸ª`babel`çš„ä½œç”¨ï¼Œå…·ä½“`babel`åŸç†è¿™é‡Œæˆ‘ä¸è¿›è¡Œè¿‡åˆ†æ·±ç©¶ã€‚

### `babel-loader`

é¦–å…ˆå¯¹äºæˆ‘ä»¬é¡¹ç›®ä¸­çš„`jsx`æ–‡ä»¶æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ª"è½¬è¯‘å™¨"å°†é¡¹ç›®ä¸­çš„`jsx`æ–‡ä»¶è½¬åŒ–æˆ`js`æ–‡ä»¶ï¼Œ`babel-loader`åœ¨è¿™é‡Œå……å½“çš„å°±æ˜¯è¿™ä¸ªè½¬è¯‘å™¨ã€‚

### `@babel/core`

ä½†æ˜¯`babel-loader`ä»…ä»…è¯†åˆ«å‡ºäº†`jsx`æ–‡ä»¶ï¼Œå†…éƒ¨æ ¸å¿ƒè½¬è¯‘åŠŸèƒ½éœ€è¦`@babel/core`è¿™ä¸ªæ ¸å¿ƒåº“ï¼Œ`@babel/core`æ¨¡å—å°±æ˜¯è´Ÿè´£å†…éƒ¨æ ¸å¿ƒè½¬è¯‘å®ç°çš„ã€‚

### `@babel/preset-env`

`@babel/prest-env`æ˜¯`babel`è½¬è¯‘è¿‡ç¨‹ä¸­çš„ä¸€äº›é¢„è®¾ï¼Œå®ƒè´Ÿè´£å°†ä¸€äº›åŸºç¡€çš„`es 6+`è¯­æ³•ï¼Œæ¯”å¦‚`const/let...`è½¬è¯‘æˆä¸ºæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„ä½çº§åˆ«å…¼å®¹æ€§è¯­æ³•ã€‚

> è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯`@babel/prest-ent`å¹¶ä¸ä¼šå¯¹äºä¸€äº›`es6+`å¹¶æ²¡æœ‰å†…ç½®ä¸€äº›é«˜ç‰ˆæœ¬è¯­æ³•çš„å®ç°æ¯”å¦‚

`Promise`ç­‰`polyfill`ï¼Œä½ å¯ä»¥å°†å®ƒç†è§£ä¸ºè¯­æ³•å±‚é¢çš„è½¬åŒ–ä¸åŒ…å«é«˜çº§åˆ«æ¨¡å—(`polyfill`)çš„å®ç°ã€‚

### `@babel/plugin-transform-runtime`

`@babel/plugin-transform-runtime`,ä¸Šè¾¹æˆ‘ä»¬æåˆ°äº†å¯¹äºä¸€äº›é«˜ç‰ˆæœ¬å†…ç½®æ¨¡å—ï¼Œæ¯”å¦‚`Promise/Generate`ç­‰ç­‰`@babel/preset-env`å¹¶ä¸ä¼šè½¬åŒ–ï¼Œæ‰€ä»¥`@babel/plugin-transform-runtime`å°±æ˜¯å¸®åŠ©æˆ‘ä»¬æ¥å®ç°è¿™æ ·çš„æ•ˆæœçš„,ä»–ä¼šåœ¨æˆ‘ä»¬é¡¹ç›®ä¸­å¦‚æœä½¿ç”¨åˆ°äº†`Promise`ä¹‹ç±»çš„æ¨¡å—ä¹‹åå»å®ç°ä¸€ä¸ªä½ç‰ˆæœ¬æµè§ˆå™¨çš„`polyfill`ã€‚

> å…¶å®ä¸`@babel/plugin-transform-runtime`è¾¾åˆ°ç›¸åŒçš„æ•ˆæœè¿˜å¯ä»¥ç›´æ¥å®‰è£…å¼•å…¥`@babel/polyfill`ï¼Œä¸è¿‡ç›¸æ¯”ä¹‹ä¸‹è¿™ç§æ–¹å¼ä¸è¢«æ¨èï¼Œä»–å­˜åœ¨æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼Œå…¨é‡å¼•å…¥é€ æˆæåŠè¿‡å¤§ä»¥åŠæ¨¡å—ä¹‹é—´é‡å¤æ³¨å…¥ç­‰ç¼ºç‚¹ã€‚

æ­¤æ—¶è¿™å‡ ä¸ªæ’ä»¶æˆ‘ä»¬å·²ç»å¯ä»¥å®ç°å°†`es6+`ä»£ç è¿›è¡Œç¼–è¯‘æˆä¸ºæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„ä½ç‰ˆæœ¬å…¼å®¹æ€§è‰¯å¥½çš„`js`ä»£ç äº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜ç¼ºå°‘æœ€é‡è¦ä¸€ç‚¹ã€‚

ç›®å‰è¿™äº›æ’ä»¶å¤„ç†çš„éƒ½æ˜¯`js`æ–‡ä»¶ï¼Œæˆ‘ä»¬å¾—è®©å¥¹èƒ½å¤Ÿè¯†åˆ«å¹¶å¤„ç†`jsx`æ–‡ä»¶ã€‚

### `@babel/preset-react`

æ­¤æ—¶å°±å¼•å…¥äº†æˆ‘ä»¬è‡³å…³é‡è¦çš„`@babel/preset-react`è¿™ä¸ªæ’ä»¶ï¼Œåœ¨`jsx`ä¸­æˆ‘ä»¬ä½¿ç”¨çš„`jsx`æ ‡ç­¾å®è´¨ä¸Šæœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆä¸º:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5381d5fb0d5a46a2aeb24a24ee73201d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

> æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„è¿™ç¯‡æ–‡ç« [`React`ä¸­çš„`jsx`åŸç†è§£æ](https://juejin.cn/post/6998859047524892709)ã€‚

æœ€ç»ˆæˆ‘ä»¬å¸Œæœ›å°†`.jsx`æ–‡ä»¶è½¬åŒ–ä¸º`js`æ–‡ä»¶åŒæ—¶å°†`jsx`æ ‡ç­¾è½¬åŒ–ä¸º`React.createElement`çš„å½¢å¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦é¢å¤–ä½¿ç”¨`babel`çš„å¦ä¸€ä¸ªæ’ä»¶-`@babel/preset-react`ã€‚

`@babel/preset-react`æ˜¯ä¸€ç»„é¢„è®¾ï¼Œæ‰€è°“é¢„è®¾å°±æ˜¯å†…ç½®äº†ä¸€ç³»åˆ—`babel plugin`å»è½¬åŒ–`jsx`ä»£ç æˆä¸ºæˆ‘ä»¬æƒ³è¦çš„`js`ä»£ç ã€‚

> `babel`æ‰€éœ€è¦çš„é…ç½®è¿™é‡Œæˆ‘ä»¬å·²ç»è®²å®Œäº†éœ€è¦ç”¨åˆ°çš„åŒ…å’Œå¯¹åº”çš„ä½œç”¨ï¼Œå› ä¸º`babel`æ¶‰åŠçš„ç¼–è¯‘åŸç†éƒ¨åˆ†çš„ç›´æ¥ç‰¹åˆ«å¤šæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»…ä»…äº†è§£å¦‚ä½•é…ç½®å°±å¯ä»¥äº†ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç§»æ­¥`babel`å®˜ç½‘å»è¯¦ç»†æŸ¥çœ‹ã€‚

### é¡¹ç›®`babel`é…ç½®

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥å®‰è£…è¿™5ä¸ªæ’ä»¶ï¼Œå¹¶ä¸”åœ¨`webpack`ä¸­è¿›è¡Œé…ç½®:

```js
yarn add -D @babel/core @babel/preset-env babel-loader @babel/plugin-transform-runtime @babel/preset-react 
å¤åˆ¶ä»£ç 
```

### åˆ›å»ºåŸºç¡€`webpack`é…ç½®

å½“æˆ‘ä»¬å®‰è£…å®Œæˆä¸Šè¾¹çš„ç¼–è¯‘å·¥å…·åï¼Œæˆ‘ä»¬å°±æ¥åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„`webpack.config.js`æ¥ä½¿ç”¨å®ƒæ¥è½¬è¯‘æˆ‘ä»¬çš„`jsx`æ–‡ä»¶:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c267af698c894be38fbfe50113269481~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æˆ‘ä»¬æ¥åœ¨é¡¹ç›®è·Ÿç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`scripts/webpack.base.js`æ–‡ä»¶ã€‚

å…³äº`webpack`å¯¹äºä»£ç çš„è½¬è¯‘ï¼Œæ‰€è°“è½¬è¯‘ç›´ç™½æ¥è®²ä¹Ÿå°±æ˜¯`webpack`é»˜è®¤åªèƒ½å¤„ç†åŸºäº`js json `çš„å†…å®¹ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è®©`webpack`å¤„ç†æˆ‘ä»¬çš„`jsx`å†…å®¹ï¼Œå°±éœ€è¦é…ç½®`loader`å‘Šè¯‰å®ƒï¼Œ

"å˜¿ï¼Œ`webpack`ç¢°åˆ°`.jsx`åç¼€çš„æ–‡ä»¶ä½¿ç”¨è¿™ä¸ª`loader`æ¥å¤„ç†ã€‚"

æˆ‘ä»¬æ¥ç¼–å†™åŸºç¡€çš„`babel-loader`é…ç½®:

#### `webpack.base.js`

```js
// scripts/webpack.base.js
const path = require('path');

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    main: path.resolve(__dirname, '../src/packages/home/index.jsx'),
  },
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        use: 'babel-loader',
      },
    ],
  },
};
å¤åˆ¶ä»£ç 
```

æ­¤æ—¶æˆ‘ä»¬å·²ç»å‘Šè¯‰`webpack`,å¦‚æœé‡åˆ°`jsx`æˆ–è€…`js`ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`babel-loader`è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡`baebel`å°†é¡¹ç›®ä¸­çš„`js/jsx`æ–‡ä»¶å¤„ç†æˆä¸ºä½ç‰ˆæœ¬æµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„ä»£ç ã€‚

#### `.babelrc`

ä¸Šè¾¹æˆ‘ä»¬è®²åˆ°äº†`babel-loader`ä»…ä»…æ˜¯ä¸€ä¸ªæ¡¥æ¢ï¼ŒçœŸæ­£éœ€è¦è½¬è¯‘ä½œç”¨çš„å…¶ä»–çš„æ’ä»¶ã€‚æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥ä½¿ç”¨å®ƒ:

`babel-loader`æä¾›äº†ä¸¤ç§é…ç½®æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨`webpack`é…ç½®æ–‡ä»¶ä¸­ç¼–å†™`options`ï¼Œå¦ä¸€ä¸ªæ˜¯å®˜æ–¹æ¨èçš„åœ¨é¡¹ç›®ç›®å½•ä¸‹å»ºç«‹`.babelrc`æ–‡ä»¶å•ç‹¬é…ç½®`babel`ã€‚

è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ¨èçš„é…ç½®:

```
// .babelrc
{
  "presets": [
    "@babel/preset-env",
    "@babel/preset-react"
  ],
  "plugins": [
    [
      "@babel/plugin-transform-runtime",
      {
        "regenerator": true
      }
    ]
  ]

}
å¤åˆ¶ä»£ç 
```

#### `packages/home`åˆ›å»ºå…¥å£æ–‡ä»¶`index.jsx`

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨`packages/home`ç›®å½•ä¸‹åˆ›å»º`home`ä¸šåŠ¡çš„å…¥å£æ–‡ä»¶

```jsx
// packages/home/index.jsx
import ReactDom from 'react-dom'

const Element = <div>hello</div>


ReactDom.render(<Element />,document.getElementById('root'))
å¤åˆ¶ä»£ç 
```

åˆ°è¿™ä¸€æ­¥ç›¸å…³åŸºç¡€é…ç½®æ–‡ä»¶å·²ç»åˆå…·æ¨¡å‹äº†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å½“æˆ‘ä»¬è°ƒç”¨`webpack`æ‰“åŒ…æˆ‘ä»¬é¡¹ç›®çš„æ—¶å€™ä½¿ç”¨æˆ‘ä»¬åˆšæ‰ä¹¦å†™çš„`webpack.base.js`è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚

#### `pacakge.json`å¢åŠ `build`è„šæœ¬

æˆ‘ä»¬æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹`pacakge.json`:

```json
{
  "name": "pages",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "build": "webpack --config ./scripts/webpack.base.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.15.5",
    "@babel/plugin-transform-runtime": "^7.15.0",
    "@babel/preset-env": "^7.15.6",
    "@babel/preset-react": "^7.14.5",
    "babel-loader": "^8.2.2",
    "webpack": "^5.53.0",
    "webpack-cli": "^4.8.0"
  },
  "dependencies": {
    "react": "^17.0.2",
    "react-dom": "^17.0.2"
  }
}
å¤åˆ¶ä»£ç 
```

> è¿™é‡Œæˆ‘ä»¬åˆ é™¤äº†åˆå§‹åŒ–çš„`test`è„šæœ¬ï¼Œå¢åŠ äº†`build`å‘½ä»¤ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿è¡Œ`npm run build`:

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a606dd987071473a8e041cb9efb3a54b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è¿™ä¸€æ­¥æˆ‘ä»¬å·²ç»æˆåŠŸè®©`webpack`è¯†åˆ«`jsx`ä»£ç å¹¶ä¸”æ”¯æŒå°†é«˜ç‰ˆæœ¬`js`è½¬åŒ–ä¸ºä½ç‰ˆæœ¬`javascript`ä»£ç äº†ã€‚

å¦‚æœæœ‰ç–‘é—®çš„è¯ï¼Œå¯ä»¥åœç•™ä¸‹æ¥åœ¨æƒ³ä¸€æƒ³å¤§æ¦‚æµç¨‹ã€‚ä¸»è¦å°±æ˜¯:

1. åˆ›å»º`babel`é…ç½®è½¬è¯‘`jsx/js`å†…å®¹ã€‚
2. åˆ›å»ºå…¥å£æ–‡ä»¶ã€‚
3. `webpack`ä¸­å¯¹äº`jsx/js`å†…å®¹ä½¿ç”¨`babel-loader`è°ƒç”¨`babel`é…ç½®å¥½çš„é¢„è®¾å’Œæ’ä»¶è¿›è¡Œè½¬è¯‘ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬ç»§ç»­æ¥æ”¯æŒ`TypeScript`å§ï¼

## é…ç½®`TypeScript`æ”¯æŒ

é’ˆå¯¹`TypeScript`ä»£ç çš„æ”¯æŒå…¶å®ä¸šå†…å­˜åœ¨ä¸¤ç§ç¼–è¯‘æ–¹å¼:

1. ç›´æ¥é€šè¿‡`TypeScript`å»ç¼–è¯‘`ts/tsx`ä»£ç ã€‚
2. é€šè¿‡`babel`è¿›è¡Œè½¬è¯‘ã€‚

å…¶å®è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯ä»¥è¾¾åˆ°ç¼–è¯‘`TypeScript`ä»£ç æˆä¸º`JavaScript`å¹¶ä¸”å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ä»£ç çš„ã€‚

æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œæœç´¢è¿™ä¸¤ç§æ–¹å¼çš„å·®å¼‚ï¼Œå¹³å¸¸åœ¨ä¸€äº›ç±»åº“çš„æ‰“åŒ…æ—¶æˆ‘ä¼šç›´æ¥ä½¿ç”¨`tsc`ç»“åˆ`tsconfig.js`ç¼–è¯‘`ts`ä»£ç ã€‚

æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä¸ªäººè¿˜æ˜¯ä¼šä½¿ç”¨`babel`è¿›è¡Œè½¬è¯‘ï¼Œå› ä¸ºæ¶‰åŠåˆ°ä¸šåŠ¡å¾€å¾€æ˜¯éœ€è¦`css`ç­‰é™æ€èµ„æºä¸`ts`ä»£ç ä¸€èµ·æ‰“åŒ…ï¼Œé‚£ä¹ˆä½¿ç”¨`babel + webpack`å…¶å®å¯ä»¥å¾ˆå¥½çš„ä¸€æ¬¡æ€§å›Šæ‹¬äº†æ‰€æœ‰çš„èµ„æºç¼–è¯‘è¿‡ç¨‹ã€‚

### `babel`æ”¯æŒ`Typescirpt`

`babel`å†…ç½®äº†ä¸€ç»„é¢„è®¾å»è½¬è¯‘`TypeScript`ä»£ç  --`@babel/preset-typescript`ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥ä½¿ç”¨`@babel/preset-typescript`é¢„è®¾æ¥æ”¯æŒ`TypeScript`è¯­æ³•å§ã€‚

```
npm install --save-dev @babel/preset-typescript
```

å®‰è£…å®Œæˆä¹‹åè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ä¿®æ”¹ä¹‹å‰çš„é…ç½®:

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥ä¿®æ”¹ä¹‹å‰`.babelrc`é…ç½®æ–‡ä»¶ï¼Œè®©`babel`æ”¯æŒè½¬è¯‘çš„`ts`æ–‡ä»¶:

```json
{
  "presets": [
    "@babel/preset-env",
    "@babel/preset-react",
+   "@babel/preset-typescript"
  ],
  "plugins": [
    [
      "@babel/plugin-transform-runtime",
      {
        "regenerator": true
      }
    ]
  ]
}
å¤åˆ¶ä»£ç 
```

è¿™é‡Œæˆ‘ä»¬åœ¨`presets`æ·»åŠ äº†`@babel/preset-typescrpt`é¢„è®¾å»è®©`babel`æ”¯æŒ`typescript`è¯­æ³•ã€‚

æ­¤æ—¶æˆ‘ä»¬çš„`babel`å·²ç»å¯ä»¥è¯†åˆ«`TypeScript`è¯­æ³•äº†

### `webpack`æ”¯æŒ`ts/tsx`æ–‡ä»¶

ä¸è¦å¿˜è®°åŒæ—¶ä¿®æ”¹æˆ‘ä»¬çš„`webpack`ä¸­`babel-loader`çš„åŒ¹é…è§„åˆ™:

```js
// webpack.base.jf
const path = require('path');

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    // è¿™é‡Œä¿®æ”¹`jsx`ä¸º`tsx`
    main: path.resolve(__dirname, '../src/packages/home/index.tsx'),
  },
  module: {
    rules: [
      {
        // åŒæ—¶è®¤è¯†ts jsx js tsx æ–‡ä»¶
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
    ],
  },
};
å¤åˆ¶ä»£ç 
```

è¿™é‡Œæˆ‘ä»¬å°†`ts,js,tsx,jsx`æ–‡ä»¶éƒ½äº¤ç»™`babel-loader`å¤„ç†ã€‚

### åˆå§‹åŒ–`tsconfig.json`

ç°åœ¨ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­å·²ç»å¯ä»¥æ”¯æŒ`tsx`æ–‡ä»¶çš„ç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç¼–è¯‘`ts`æ–‡ä»¶ä¸ºä½ç‰ˆæœ¬`js`æ–‡ä»¶äº†ã€‚

åœ¨ä½¿ç”¨`Ts`æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦é…ç½®`typescript`çš„é…ç½®æ–‡ä»¶ï¼Œæ²¡é”™å°±æ˜¯`tsconfig.json`ã€‚

ä¹Ÿè®¸ä½ å·²ç»è§åˆ°è¿‡å¾ˆå¤šæ¬¡`tsconfig.json`äº†ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å»å®‰è£…`typescript`å¹¶ä¸”åˆå§‹åŒ–å§ï½

é¡¹ç›®å†…å®‰è£…`Ts`:

```
yarn add -D typescript 
```

è°ƒç”¨`tsc --init`å‘½ä»¤åˆå§‹åŒ–`tsconfig.json`:

```
npx tsc --init
```

> å…³äº`npx`å‘½ä»¤å’Œ`npm`çš„å…³ç³»ï¼Œä¹‹åæˆ‘ä¼šåœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ç»†ç»†è®²è¿°ã€‚äº†è§£ä»–åœ¨è¿™é‡Œçš„ç”¨é€”:è°ƒç”¨å½“å‰é¡¹ç›®å†…`node_modules/typescript/bin`çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œ`init`å‘½ä»¤å°±å¯ä»¥äº†ã€‚

ç°åœ¨æˆ‘ä»¬çš„ç›®å½•åº”è¯¥æ˜¯è¿™æ ·çš„:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/570a45bbc6bd4305a2cbf8a0d432b150~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

> è™½ç„¶è¯´æˆ‘ä»¬ä½¿ç”¨`babel`è¿›è¡Œçš„ç¼–è¯‘ï¼Œ`tsconfig.json`å¹¶ä¸ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæ•ˆã€‚ä½†æ˜¯`tsconfig.json`ä¸­çš„é…ç½®éå¸¸å½±å“æˆ‘ä»¬çš„å¼€å‘ä½“éªŒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¸€ä¸‹å®ƒå§ã€‚

### é…ç½®`tsconfig.json`

é¦–å…ˆæˆ‘ä»¬æ¥æ‰¾åˆ°å¯¹åº”çš„`jsx`é€‰é¡¹:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa93d62e6a344fcfae8d86c488bcfe4e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

ä»–çš„ä½œç”¨æ˜¯æŒ‡å®š`jsx`çš„ç”Ÿæˆä»€ä¹ˆæ ·çš„ä»£ç ï¼Œç®€å•æ¥è¯´ä¹Ÿå°±æ˜¯`jsx`ä»£ç å°†è¢«è½¬åŒ–æˆä¸ºä»€ä¹ˆã€‚

è¿™é‡Œæˆ‘ä»¬å°†å®ƒä¿®æ”¹ä¸º`react`ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9abe103ea4cb410da1cbe96cb0d2bde7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹`ts`ä¸­çš„æ¨¡å—è§£æè§„åˆ™ï¼Œå°†å®ƒä¿®æ”¹ä¸º`node`:

```
"moduleResolution": "node",
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f061ee95a7a48e1a44b185819e65206~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

> è¿™é‡Œæš‚æ—¶æˆ‘ä»¬å…ˆä¿®æ”¹è¿™ä¸¤ä¸ªé…ç½®ï¼Œåç»­é…ç½®æˆ‘ä»¬ä¼šåœ¨åè¾¹çš„è®²è§£ä¸­æ¸è¿›å¼çš„è¿›è¡Œé…ç½®ã€‚

> æ¨èä¸€æœ¬å¼€æºçš„ç”µå­ä¹¦ï¼Œè¿™é‡Œç½—åˆ—äº†å¤§éƒ¨åˆ†[`tsconfig.json`é…ç½®ä¿¡æ¯](https://link.juejin.cn?target=https%3A%2F%2Fjkchao.github.io%2Ftypescript-book-chinese%2Fproject%2FcompilationContext.html%23tsconfig-json)

### å¤„ç†æŠ¥é”™

æˆ‘ä»¬å·²ç»åœ¨é¡¹ç›®ä¸­å®Œç¾æ”¯æŒäº†`typescript`,æ¥ä¸‹é‡Œè®©æˆ‘ä»¬æŠŠ`pacakges/home/index.jsx`æ”¹ä¸º`packages/home/index.tsx`å§.

ä¿®æ”¹å®Œæˆåç¼€åæˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬æƒ³é¡¹ç›®æ–‡ä»¶:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4eb24a3e3b7e45cd9d55cf64bc77e061~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æˆ‘ä»¬æ¥ä¸€ä¸ªä¸€ä¸ªè§£å†³è¿™äº›æŠ¥é”™:

é¦–å…ˆæˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åŒ…åœ¨`TypeScript`æ–‡ä»¶æ—¶ï¼Œç®€å•æ¥è¯´å®ƒä¼šå¯»æ‰¾å¯¹åº”åŒ…çš„`package.json`ä¸­çš„`type`å­—æ®µæŸ¥æ‰¾å¯¹åº”çš„ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚

`react`å’Œ`react-dom`è¿™ä¸¤ä¸ªåŒ…ä»£ç ä¸­éƒ½ä¸å­˜åœ¨å¯¹åº”çš„ç±»å‹å£°æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å•ç‹¬å®‰è£…ä»–ä»¬å¯¹åº”çš„ç±»å‹å£°æ˜æ–‡ä»¶:

```
yarn add -D @types/react-dom @types/react
```

> å¤§å¤šæ•°é¢å¤–çš„ç±»å‹å®šä¹‰åŒ…ï¼Œä½ å¯åœ¨[è¿™é‡Œ](https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdt%2Fsearch%3Fsearch%3Dreact-dom)æ‰¾åˆ°

å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å†çœ‹çœ‹å½“å‰çš„`index.tsx`æ–‡ä»¶:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7c5088bbc6744f3a493c9740b66ff63~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ­¤æ—¶,ä»…å‰©ä¸‹ä¸€ä¸ªæŠ¥é”™äº†ã€‚è®©æˆ‘ä»¬æ¥ä»”ç»†å®šä½ä¸€ä¸‹é”™è¯¯ã€‚`ts`å‘Šè¯‰æˆ‘ä»¬`ReactDom.render`æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°ç±»å‹ä¸å…¼å®¹ã€‚å—¯,æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬`react`è¯­æ³•å†™é”™äº†ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/508c77dfa655461eb0848bba57364fd3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ­¤æ—¶æˆ‘ä»¬çš„é¡¹ç›®å·²ç»å¯ä»¥å®Œæˆæ”¯æŒ`typescript`å’Œ`react`äº†ã€‚

## `webpack`é…ç½®é™æ€èµ„æºæ”¯æŒ

ä¸€ä¸ªæˆç†Ÿçš„é¡¹ç›®åªèƒ½æœ‰`ts`æ€ä¹ˆèƒ½å¤Ÿå‘¢ï¼Ÿ æ¯•ç«Ÿä¸€ä¸ªæˆç†Ÿçš„ä¸šåŠ¡ä»”æ€ä¹ˆè„±ç¦»`css`çš„é­”æŠ“å‘¢ğŸ˜‚

ä¹Ÿè®¸ä½ ä¹‹å‰æ¥è§¦è¿‡`webpack5`ä¹‹å‰çš„é™æ€èµ„æºå¤„ç†ï¼Œ`file-loader,url-loader,row-loader`è¿™äº›`loader`æ˜¯ä¸æ˜¯å¬èµ·æ¥ç‰¹åˆ«ç†Ÿæ‚‰ã€‚

> `webpack`é»˜è®¤æ˜¯ä¸æ”¯æŒé`js`æ–‡ä»¶çš„ï¼Œæ‰€ä»¥åœ¨`webpack5`ä¹‹å‰æˆ‘ä»¬é€šè¿‡`loader`çš„æ–¹å¼è¿”å›å¯æ‰§è¡Œçš„`js`è„šæœ¬æ–‡ä»¶ï¼Œå†…éƒ¨å°†å¤„ç†è¿™äº›`webpack`ä¸è®¤è¯†çš„æ–‡ä»¶ã€‚

åœ¨`webpack 5+`ç‰ˆæœ¬ä¹‹åï¼Œè¿™äº›`loader`çš„ä½œç”¨éƒ½å·²ç»è¢«å†…ç½®äº†ï½

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹åº”è¯¥å¦‚ä½•é…ç½®,å…·ä½“å¯¹åº”çš„ä½œç”¨å¯ä»¥æŸ¥çœ‹[`webpack`èµ„æºæ¨¡å—](https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fasset-modules%2F%23inlining-assets)

### å¤„ç†å›¾ç‰‡,æ–‡ä»¶èµ„æºæ–‡ä»¶

> èµ„æºæ¨¡å—ç±»å‹(asset module type)ï¼Œé€šè¿‡æ·»åŠ  4 ç§æ–°çš„æ¨¡å—ç±»å‹ï¼Œæ¥æ›¿æ¢æ‰€æœ‰è¿™äº› loaderï¼š

- `asset/resource` å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URLã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ `file-loader` å®ç°ã€‚
- `asset/inline` å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ data URIã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ `url-loader` å®ç°ã€‚
- `asset/source` å¯¼å‡ºèµ„æºçš„æºä»£ç ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ `raw-loader` å®ç°ã€‚
- `asset` åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ `url-loader`ï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ç§¯é™åˆ¶å®ç°ã€‚

å½“åœ¨ `webpack 5` ä¸­ä½¿ç”¨æ—§çš„ `assets loader`ï¼ˆå¦‚ `file-loader`/`url-loader`/`raw-loader` ç­‰ï¼‰å’Œ asset æ¨¡å—æ—¶ï¼Œä½ å¯èƒ½æƒ³åœæ­¢å½“å‰ asset æ¨¡å—çš„å¤„ç†ï¼Œå¹¶å†æ¬¡å¯åŠ¨å¤„ç†ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ asset é‡å¤ï¼Œä½ å¯ä»¥é€šè¿‡å°† asset æ¨¡å—çš„ç±»å‹è®¾ç½®ä¸º `'javascript/auto'` æ¥è§£å†³ã€‚

> å…³äºé…ç½®`type:'asset'`åï¼Œwebpack å°†æŒ‰ç…§é»˜è®¤æ¡ä»¶ï¼Œè‡ªåŠ¨åœ°åœ¨ `resource` å’Œ `inline` ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼šå°äº 8kb çš„æ–‡ä»¶ï¼Œå°†ä¼šè§†ä¸º `inline` æ¨¡å—ç±»å‹ï¼Œå¦åˆ™ä¼šè¢«è§†ä¸º `resource` æ¨¡å—ç±»å‹ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® [`Rule.parser.dataUrlCondition.maxSize`](https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fmodule%2F%23ruleparserdataurlcondition) é€‰é¡¹æ¥ä¿®æ”¹æ­¤æ¡ä»¶

> å…¶å®`maxSize`å°±ç›¸å½“äº`url-loader`ä¸­çš„`limit`å±æ€§ï¼Œèµ„æºå¤§å°åœ¨`maxSize`ä¹‹å†…ä½¿ç”¨è¡Œå†…`asset/inline`å¤„ç†ï¼Œè¶…è¿‡ä¹‹åå°±ä½¿ç”¨`resource`å¯¼å‡ºèµ„æºã€‚å½“ç„¶è¿™ä¸ªé…ç½®ä¹Ÿæ”¯æŒå¯¼å‡ºä¸€ä¸ªå‡½æ•°è‡ªå®šä¹‰é…ç½®å®ç°ã€‚

äº†è§£äº†`assets`æ¨¡å—çš„ç”¨é€”ä¹‹åï¼Œæˆ‘ä»¬æ¥è¯•ç€é…ç½®å®ƒæ¥å¤„ç†é™æ€èµ„æº:

```js
const path = require('path');

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    main: path.resolve(__dirname, '../src/packages/home/index.tsx'),
  },
  module: {
    rules: [
      {
        // åŒæ—¶è®¤è¯†ts jsx js tsx æ–‡ä»¶
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
      {
        test: /\.(png|jpe?g|svg|gif)$/,
        type:'asset/inline'
      },
      {
        test: /\.(eot|ttf|woff|woff2)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[hash][ext][query]',
        },
      },
    ],
  },
};
å¤åˆ¶ä»£ç 
```

è¿™ä¸€æ­¥æˆ‘ä»¬å·²ç»å…³äºå›¾ç‰‡å’Œå­—ä½“æ–‡ä»¶é…ç½®å·²ç»é…ç½®å®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ç›®å½•ç»“æ„éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„é…ç½®æ˜¯å¦ç”Ÿæ•ˆ:

### éªŒè¯é…ç½®æ•ˆæœ

#### ä¿®æ”¹`packages`

é¦–å…ˆè®©æˆ‘ä»¬å…ˆæ¥ä¿®æ”¹`packages`ï¼Œ`packages`æ–‡ä»¶å¤¹ä¹‹å‰è®²è¿‡æ˜¯å­˜æ”¾å¤šé¡µé¢åº”ç”¨ä¸­æ¯ä¸ªé¡µé¢çš„å…¥å£æ–‡ä»¶çš„ã€‚è®©æˆ‘ä»¬åœ¨`home`æ–‡ä»¶å¤¹ä¸‹å…ˆæ–°å»ºä¸€ä¸ª`app.tsx`:

```tsx
// src/packages/home/app.tsx
import React from 'react'
import ReactDom from 'react-dom'
// è¿™é‡ŒAppä»…æ¥ç€å°±ä¼šé™åˆ° å®ƒå°±æ˜¯å°±æ˜¯ä¸€ä¸ªReact FunctionComponent
import { App } from '../../containers/home/app.tsx'

ReactDom.render(<App />, document.getElementById('root'))
å¤åˆ¶ä»£ç 
```

#### ä¿®æ”¹`containers`

`containers`æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹æ˜¯å­˜æ”¾æ¯ä¸ªé¡µé¢åº”ç”¨ä¸åŒçš„ä¸šåŠ¡é€»è¾‘çš„éƒ¨åˆ†ã€‚

è®©æˆ‘ä»¬åœ¨`containers`ä¸­æ–°å»º`app.tsx`ä½œä¸ºè·Ÿåº”ç”¨ï¼Œä»¥åŠåŒçº§ç›®å½•ä¸‹æ–°å»º`assets`,`styles`,`views`ä¸‰ä¸ªç›®å½•:

- `assets`å­˜æ”¾å½“å‰æ¨¡å—ç›¸å…³é™æ€èµ„æºï¼Œæ¯”å¦‚å›¾ç‰‡ï¼Œå­—ä½“æ–‡ä»¶ç­‰ã€‚
- `styles`å­˜åœ¨å½“å‰æ¨¡å—ç›¸å…³æ ·å¼æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®ç›¸å…³æ ·å¼æ–‡ä»¶çš„å¤„ç†ï¼Œä¹‹åä¼šè¯¦ç»†ä»‹ç»ã€‚
- `views`å­˜æ”¾å½“å‰æ¨¡å—ä¸‹ç›¸å…³é¡µé¢é€»è¾‘é¡µé¢æ‹†åˆ†

æˆ‘ä»¬ç»™`assets`ä¸­æ–°å»ºä¸€ä¸ª`images`æ–‡ä»¶å¤¹ï¼Œæ”¾å…¥ä¸€å¼ `logo`,å›¾ç‰‡ã€‚

ä¿®æ”¹`app.tsx`å†…å®¹å¦‚ä¸‹:

```tsx
import React from 'react'
import Banner from './assets/image/banner.png'

const App: React.FC = () => {
  return <div>
    <p>Hello,This is pages!</p>
    <img src={Banner} alt="" />
  </div>
}

export {
  App
}
å¤åˆ¶ä»£ç 
```

#### `yarn build`

æˆ‘ä»¬å½“å‰çš„ç›®å½•ç»“æ„å¦‚ä¸‹:

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9bda34ca0b84430997317397d11d5dd1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

åŸºæœ¬çš„ç›®å½•ç»“æ„æˆ‘ä»¬å·²ç»æ­å»ºæˆåŠŸï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿è¡Œ`yarn build`ã€‚

é¦–å…ˆæ ¹æ®`webpack`ä¸­çš„å…¥å£æ–‡ä»¶ä¼šå»å¯»æ‰¾`packages/home/index.tsx`ï¼Œæˆ‘ä»¬åœ¨`index.tsx`ä¸­å¼•å…¥äº†å¯¹åº”çš„`containers/app.tsx`ï¼Œ`webpack`ä¼šåŸºäºæˆ‘ä»¬çš„`import`è¯­æ³•å»å¤„ç†æ¨¡å—ä¾èµ–å…³ç³»æ„å»ºæ¨¡å—ã€‚

åŒæ—¶å› ä¸ºæˆ‘ä»¬åœ¨`app.tsx`ä¸­å¼•å…¥äº†å›¾ç‰‡

```js
// webpack.base.js
 {
        test: /\.(png|jpe?g|svg|gif)$/,
        type: 'asset/inline'
  },
å¤åˆ¶ä»£ç 
```

æ­¤æ—¶`type:'assets/inline'`é’ˆå¯¹å›¾ç‰‡çš„å¤„ç†å°±ä¼šç”Ÿæ•ˆäº†ï¼

è®©æˆ‘ä»¬æ¥çœ‹çœ‹`build`ä¹‹åçš„æ–‡ä»¶:

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef760239ef8c42d1a177b2199cc4188a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

> `asset/inline`ä¼šè®²èµ„æºæ–‡ä»¶å†…ç½®æˆä¸º`base64`å’Œ`url-loader`æ˜¯ç›¸åŒçš„ä½œç”¨ã€‚

> å½“å‰ç›®å‰`webpack`çš„`asset/inline`æ¨¡å—ä¼šå°†æ‰€æœ‰èµ„æºè½¬åŒ–ä¸º`base64`åœ¨è¡Œå†…è¿å…¥ï¼Œå¦‚æœè¦è¾¾åˆ°`url-loader`ä¸­`limit`çš„é…ç½®éœ€è¦ç¦ç”¨`asset/inline`ä½¿ç”¨`url-loader`å¤„ç†æˆ–è€…ä½¿ç”¨`type:'asset'`æ¥å¤„ç†.

#### è§£å†³æŠ¥é”™

ç»†å¿ƒçš„ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œç›®å‰æˆ‘ä»¬é¡¹ç›®ä¸­å­˜åœ¨ä¸¤ä¸ªé—®é¢˜:

1. `ts`æ–‡ä»¶ä¸­é’ˆå¯¹`image`çš„å¼•å…¥ï¼Œ`ts`å¹¶ä¸èƒ½æ­£ç¡®çš„è¯†åˆ«ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bf52f22286d4f4a830386f23b722e8c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`image.d.ts`åœ¨æ ¹ç›®å½•ä¸‹:

```ts
declare module '*.svg';
declare module '*.png';
declare module '*.jpg';
declare module '*.jpeg';
declare module '*.gif';
declare module '*.bmp';
declare module '*.tiff';
å¤åˆ¶ä»£ç 
```

> `declare`ä¸ºå£°æ˜è¯­æ³•ï¼Œæ„æ€ä¸ºå£°æ˜`ts`å…¨å±€æ¨¡å—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸å¼•å…¥å¯¹åº”çš„èµ„æºäº†ã€‚

1. æˆ‘ä»¬åœ¨`index.tsx`ä¸­å¼•å…¥äº†å¯¹åº”çš„`app.tsx`ï¼Œå½“å­˜åœ¨åç¼€æ—¶`ts`ä¼šè¿›è¡ŒæŠ¥é”™æç¤º:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/930f6e29024c484a904e512c60e88f40~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜å§ã€‚å…¶å®æ— æ³•å°±æ˜¯å¼•å…¥æ–‡ä»¶æ—¶é»˜è®¤åç¼€åçš„é—®é¢˜:

- ç›®å‰`webpack`ä¸æ”¯æŒé»˜è®¤åç¼€å`.tsx`
- è€Œ`tsconfig.json`ä¸­æ˜¯æ”¯æŒåç¼€å`.tsx`ï¼Œæ‰€ä»¥æ˜¾ç¤ºå£°æ˜ä¼šæç¤ºé”™è¯¯ã€‚

æˆ‘ä»¬æ¥ç»Ÿä¸€è¿™ä¸¤ä¸ªé…ç½®:

## åˆ«åç»Ÿä¸€

### ä¿®æ”¹`webpack`åˆ«åé…ç½®

```js
// webpack.base.js
const path = require('path');

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    main: path.resolve(__dirname, '../src/packages/home/index.tsx'),
  },
  resolve: {
    alias: {
      '@src': path.resolve(__dirname, '../src'),
      '@packages': path.resolve(__dirname, '../src/packages'),
      '@containers': path.resolve(__dirname, '../src/containers'),
    },
    mainFiles: ['index', 'main'],
    extensions: ['.ts', '.tsx', '.scss', 'json', '.js'],
  },
  module: {
    rules: [
      {
        // åŒæ—¶è®¤è¯†ts jsx js tsx æ–‡ä»¶
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
      {
        test: /\.(png|jpe?g|svg|gif)$/,
        type: 'asset/inline'
      },
      {
        test: /\.(eot|ttf|woff|woff2)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[hash][ext][query]',
        },
      },
    ],
  },
};
å¤åˆ¶ä»£ç 
```

è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†`resolve`çš„å‚æ•°ï¼Œé…ç½®äº†åˆ«å`@src`,`@package`,`@container`ã€‚

ä»¥åŠå½“æˆ‘ä»¬ä¸ä¹¦å†™æ–‡ä»¶åç¼€æ—¶ï¼Œé»˜è®¤çš„è§£æè§„åˆ™`extensions`è§„åˆ™ã€‚

åŒæ—¶è¿˜é…ç½®äº†`mainFiles`ï¼Œè§£ææ–‡ä»¶å¤¹è·¯å¾„ï½

è¿™ä¸ªä¸‰ä¸ªé…ç½®éƒ½æ¯”è¾ƒåŸºç¡€ï¼Œå°±ä¸è¿‡å¤šæ·±å…¥äº†å“ˆã€‚å¦‚æœä»ç„¶è¿˜æ˜¯ä¸æ˜¯å¾ˆæ‡‚ï¼Œç”¨åˆ°çš„æ—¶å€™å¤šç¿»ç¿»æ…¢æ…¢ä¹Ÿå°±è®°ä½å•¦ï¼

è®©æˆ‘ä»¬æ¥å°è¯•ä¿®æ”¹`index.tsx`ï¼Œä½¿ç”¨åˆ«åæ¥å¼•å…¥:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07b6375941b3451281c4bdbafdf34bf5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ­¤æ—¶æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰è·¯å¾„æç¤ºï¼Œè¿™ä¸ªï¼æ˜¯çœŸçš„æ— æ³•æ¥å—ï¼

åŸå› æ˜¯æˆ‘ä»¬æ˜¯åŸºäº`typescript`å¼€å‘ï¼Œæ‰€ä»¥`ts`æ–‡ä»¶ä¸­å¹¶ä¸çŸ¥é“æˆ‘ä»¬åœ¨`webpack`ä¸­é…ç½®çš„åˆ«åè·¯å¾„ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åŒæ­¥ä¿®æ”¹`tsconfig.json`ï¼Œè®©`tsconfig.json`ä¹Ÿæ”¯æŒåˆ«åä»¥åŠåˆšæ‰çš„é…ç½®ï¼Œè¾¾åˆ°æœ€ä½³çš„å¼€å‘ä½“éªŒã€‚

### ä¿®æ”¹`tsconfig.json`åˆ«åé…ç½®

æˆ‘ä»¬æ¥ä¿®æ”¹`tsconfig.json`ï¼Œè®©`ts`åŒæ­¥æ”¯æŒå¼•å…¥:

```json
    // tsconfig.json
    ...
     "baseUrl": "./",
    /* Specify the base directory to resolve non-relative module names. */
    "paths": {
      "@src/*": ["./src/*"],
      "@packages/*": ["./src/packages/*"],
      "@containers/*": ["./src/containers/*"],
    },
å¤åˆ¶ä»£ç 
```

å¦‚æœè¦é…ç½®`paths`é‚£ä¹ˆä¸€å®šæ˜¯è¦é…ç½®`baseUrl`çš„ï¼Œæ‰€è°“`baseUrl`å°±æ˜¯æˆ‘ä»¬çš„`paths`æ˜¯ç›¸å¯¹äºé‚£ä¸ªè·¯å¾„å¼€å§‹çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬åœ¨`paths`ä¸­æ·»åŠ å¯¹åº”çš„åˆ«åè·¯å¾„å°±å¯ä»¥å®Œæˆé…ç½®ï¼Œè®©`ts`ä¹Ÿå¯ä»¥åˆç†è§£æå‡ºæˆ‘ä»¬çš„ç±»å‹åˆ«åã€‚

æ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹çœ‹:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0e02957c58a4a8b8c503a04faf851c0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

å·²ç»å¯ä»¥æ­£ç¡®å‡ºç°è·¯å¾„æç¤ºäº†ï¼Œæ˜¯ä¸æ˜¯éå¸¸`nice`ã€‚

é’ˆå¯¹è·¯å¾„/æ–‡ä»¶ç›®å½•è§£æè§„åˆ™é…ç½®æˆ‘ä»¬ç›®å‰å°±å‘Šä¸€æ®µè½äº†ï½

## é…ç½®`css/sass`

æ¥ä¸‹æ¥æˆ‘ä»¬ç»™é¡¹ç›®æ·»åŠ ä¸€äº›æ ·å¼æ¥ç¾åŒ–å®ƒã€‚

è¿™é‡Œå…¶å®`React`é¡¹ç›®æœ‰å¤ªå¤šæœ‰å…³`css`çš„äº‰åµäº†,ä½†æ˜¯æ— è®ºå¦‚ä½•æˆ‘ä»¬æ˜¯éƒ½è¦åœ¨`webpack`ä¸­é’ˆå¯¹`css`è¿›è¡Œå¤„ç†çš„ã€‚

> è¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨`sass`é¢„å¤„ç†å™¨è¿›è¡Œæ¼”ç¤ºï¼Œå…¶ä»–`less`ç­‰éƒ½æ˜¯åŒç†ã€‚

é’ˆå¯¹äº`sass`æ–‡ä»¶ï¼ŒåŒæ ·æ˜¯`webpack`ä¸è®¤è¯†çš„æ–‡ä»¶ã€‚å’±ä»¬åŒæ ·æ˜¯éœ€è¦`loader` å»å¤„ç†ã€‚

è¿™é‡Œç”¨åˆ°çš„`loader`å¦‚ä¸‹:

- `sass-loader`
- `resolve-url-loader`
- `postcss-loader`
- `css-loader`
- `MiniCssExtractPlugin.loader`

æˆ‘ä»¬æ¥ä¸€ä¸ªä¸€ä¸ªæ¥åˆ†æè¿™äº›`loader`çš„ä½œç”¨çš„å¯¹åº”çš„é…ç½®:

### `sass-loader`

é’ˆå¯¹äº`sass`æ–‡ä»¶æˆ‘ä»¬é¦–å…ˆä¸€å®šæ˜¯è¦ä½¿ç”¨`sass`ç¼–è¯‘æˆä¸º`css`çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹`.scss`ç»“å°¾çš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘æˆä¸º`css`æ–‡ä»¶ã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦å®‰è£…:

```
yarn add -D sass-loader sass 
å¤åˆ¶ä»£ç 
```

> `sass-loader` éœ€è¦é¢„å…ˆå®‰è£… [Dart Sass](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsass%2Fdart-sass) æˆ– [Node Sass](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsass%2Fnode-sass)ï¼ˆå¯ä»¥åœ¨è¿™ä¸¤ä¸ªé“¾æ¥ä¸­æ‰¾åˆ°æ›´å¤šçš„èµ„æ–™ï¼‰ã€‚è¿™å¯ä»¥æ§åˆ¶æ‰€æœ‰ä¾èµ–çš„ç‰ˆæœ¬ï¼Œ å¹¶è‡ªç”±çš„é€‰æ‹©ä½¿ç”¨çš„ Sass å®ç°ã€‚

`sass-loader`çš„ä½œç”¨å°±ç±»ä¼¼æˆ‘ä»¬ä¹‹å‰è®²åˆ°è¿‡çš„`babel-loader`ï¼Œå¯ä»¥å°†å®ƒç†è§£æˆä¸ºä¸€ä¸ªæ¡¥æ¢ï¼Œ`sass`è½¬è¯‘æˆä¸º`css`çš„æ ¸å¿ƒæ˜¯ç”±`node-sass`æˆ–è€…`dart-sass`å»è¿›è¡Œç¼–è¯‘å·¥ä½œçš„ã€‚

### `resolve-url-loader`

ä¸Šä¸€æ­¥æˆ‘ä»¬å·²ç»è®²åˆ°è¿‡`sass-loader`å°†`sass`æ–‡ä»¶è½¬åŒ–ä¸º`css`æ–‡ä»¶ã€‚

ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å…³äº`webpack`å¯¹`scss`æ–‡ä»¶ä¸­

ç”±äº Saass çš„å®ç°æ²¡æœ‰æä¾› [url é‡å†™](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsass%2Flibsass%2Fissues%2F532)çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ç›¸å…³çš„èµ„æºéƒ½å¿…é¡»æ˜¯ç›¸å¯¹äºè¾“å‡ºæ–‡ä»¶ï¼ˆ`ouput`ï¼‰è€Œè¨€çš„ã€‚

- å¦‚æœç”Ÿæˆçš„ CSS ä¼ é€’ç»™äº† `css-loader`ï¼Œåˆ™æ‰€æœ‰çš„ url è§„åˆ™éƒ½å¿…é¡»æ˜¯ç›¸å¯¹äºå…¥å£æ–‡ä»¶çš„ï¼ˆä¾‹å¦‚ï¼š`main.scss`ï¼‰ã€‚
- å¦‚æœä»…ä»…ç”Ÿæˆäº† CSS æ–‡ä»¶ï¼Œæ²¡æœ‰å°†å…¶ä¼ é€’ç»™ `css-loader`ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ url éƒ½æ˜¯ç›¸å¯¹äºç½‘ç«™çš„æ ¹ç›®å½•çš„ã€‚

æ‰€ä»¥é’ˆå¯¹äº`sass`ç¼–è¯‘åçš„`css`æ–‡ä»¶ä¸­çš„è·¯å¾„æ˜¯ä¸æ­£ç¡®çš„ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç›¸å¯¹è·¯å¾„æ¨¡å¼ã€‚

æƒ³è¦è§£å†³è·¯å¾„å¼•å…¥çš„é—®é¢˜ä¸šå†…æœ‰å¾ˆå¤šç°æˆçš„åŠæ³•ï¼Œæ¯”å¦‚é€šè¿‡

1. è·¯å¾„å˜é‡å®šä¹‰å¼•å…¥è·¯å¾„
2. å®šä¹‰åˆ«åï¼Œ`sass`ä¸­ä½¿ç”¨åˆ«åå¼•å…¥è·¯å¾„
3. `resolve-url-loader`

> è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨`resolve-url-loader`æ¥å¤„ç†æ–‡ä»¶å¼•å…¥è·¯å¾„é—®é¢˜ã€‚

> ä¸è¦å¿˜è®°`yarn add -D resolve-url-loader`

### `postcss-loader`

PostCSSæ˜¯ä»€ä¹ˆï¼Ÿæˆ–è®¸ï¼Œä½ ä¼šè®¤ä¸ºå®ƒæ˜¯é¢„å¤„ç†å™¨ã€æˆ–è€…åå¤„ç†å™¨ç­‰ç­‰ã€‚å…¶å®ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºä¸€ç§æ’ä»¶ç³»ç»Ÿã€‚

é’ˆå¯¹äº`postcss`å…¶å®æˆ‘è¿™é‡Œå¹¶ä¸æ‰“ç®—æ·±å…¥å»è®²è§£ï¼Œå®ƒæ˜¯`babel`ä¸€æ ·éƒ½æ˜¯ä¸¤ä¸ªåºç„¶å¤§ç‰©ã€‚æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ä½“ç³»,åœ¨è¿™é‡Œä½ éœ€è¦æ¸…æ¥šçš„æ˜¯æˆ‘ä»¬ä½¿ç”¨`postcss-loader`å¤„ç†ç”Ÿæˆçš„`css`ã€‚

ç¬¬ä¸€æ­¥é¦–å…ˆå®‰è£…`post-css`å¯¹åº”çš„å†…å®¹:

```
yarn add -D postcss-loader postcss
å¤åˆ¶ä»£ç 
```

`postcss-loader`åŒæ—¶æ”¯æŒç›´æ¥åœ¨`loader`ä¸­é…ç½®è§„åˆ™é€‰é¡¹ï¼Œä¹Ÿæ”¯æŒå•ç‹¬å»ºç«‹æ–‡ä»¶é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©å•ç‹¬ä½¿ç”¨æ–‡ä»¶è¿›è¡Œé…ç½®:

æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`postcss.config.js`çš„æ–‡ä»¶:

```js
module.exports = {
  plugins: [
    require('autoprefixer'),
    require('cssnano')({
      preset: 'default',
    }),
  ],
}
å¤åˆ¶ä»£ç 
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸¤ä¸ª`postcss`çš„æ’ä»¶:

- `autoprefixer`æ’ä»¶çš„ä½œç”¨æ˜¯ä¸ºæˆ‘ä»¬çš„`css`å†…å®¹æ·»åŠ æµè§ˆå™¨å‚å•†å‰ç¼€å…¼å®¹ã€‚
- `cssnano`çš„ä½œç”¨æ˜¯å°½å¯èƒ½å°çš„å‹ç¼©æˆ‘ä»¬çš„`css`ä»£ç ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å»å®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶:

```shell
yarn add -D cssnano autoprefixer@latest
å¤åˆ¶ä»£ç 
```

### `css-loader`

`css-loader`æ˜¯è§£ææˆ‘ä»¬`css`æ–‡ä»¶ä¸­çš„`@import/require`è¯­å¥åˆ†æçš„.

```shell
yarn add -D css-loader
å¤åˆ¶ä»£ç 
```

### `MiniCssExtractPlugin.loader`

è¿™ä¸ªæ’ä»¶å°† CSS æå–åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚å®ƒä¸ºæ¯ä¸ªåŒ…å«`CSS` çš„ `JS` æ–‡ä»¶åˆ›å»ºä¸€ä¸ª `CSS` æ–‡ä»¶ã€‚å®ƒæ”¯æŒæŒ‰éœ€åŠ è½½ CSS å’Œ `SourceMaps`ã€‚

è¿™é‡Œéœ€è¦æä¸€ä¸‹ä»–å’Œ`style-loader`çš„åŒºåˆ«ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†`MiniCssExtractPlugin`ä»£æ›¿äº†`style-loader`ã€‚

`style-loader`ä¼šå°†ç”Ÿæˆçš„`css`æ·»åŠ åˆ°`html`çš„`header`æ ‡ç­¾å†…å½¢æˆå†…æ•›æ ·å¼ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`MiniCssExtractPlugin.loader`çš„ä½œç”¨å°±æ˜¯æ‹†åˆ†ç”Ÿæˆçš„`css`æˆä¸ºç‹¬ç«‹çš„`css`æ–‡ä»¶ã€‚

> ```
> yarn add -D mini-css-extract-plugin
> ```

### ç”Ÿæˆ`sass`æœ€ç»ˆé…ç½®æ–‡ä»¶

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç”Ÿæˆ`sass`æ–‡ä»¶çš„æœ€ç»ˆé…ç½®æ–‡ä»¶:

```js
// webapck.base.js
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    main: path.resolve(__dirname, '../src/packages/home/index.tsx'),
  },
  resolve: {
    alias: {
      '@src': path.resolve(__dirname, '../src'),
      '@packages': path.resolve(__dirname, '../src/packages'),
      '@containers': path.resolve(__dirname, '../src/containers'),
    },
    mainFiles: ['index', 'main'],
    extensions: ['.ts', '.tsx', '.scss', 'json', '.js'],
  },
  module: {
    rules: [
      {
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
      {
        test: /\.(sa|sc)ss$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
          },
          'css-loader',
          'postcss-loader',
          {
            loader: 'resolve-url-loader',
            options: {
              keepQuery: true,
            },
          },
          {
            loader: 'sass-loader',
            options: {
              sourceMap: true
            },
          },
        ],
      },
      {
        test: /\.(png|jpe?g|svg|gif)$/,
        type: 'asset/inline'
      },
      {
        test: /\.(eot|ttf|woff|woff2)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[hash][ext][query]',
        },
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'assets/[name].css',
    }),
  ]
};
å¤åˆ¶ä»£ç 
// postcss.config.js
module.exports = {
  plugins: [
    require('autoprefixer'),
    require('cssnano')({
      preset: 'default',
    }),
  ],
}
å¤åˆ¶ä»£ç 
```

å®Œæˆè¿™äº›é…ç½®ä¹‹åï¼ŒåŒæ—¶æˆ‘ä»¬åœ¨`containers/src/home/styles`ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª`sass`æ–‡ä»¶`index.scss`:

è®©æˆ‘ä»¬æ¥å†™ä¸€äº›ç®€å•çš„æ ·å¼æ–‡ä»¶:

```css
.body {
	background-color: red;
}
å¤åˆ¶ä»£ç 
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b82a8114e98a41d08206173cb28f7214~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è¿™ä¹‹åï¼Œè®©æˆ‘ä»¬é‡æ–°è¿è¡Œ`yarn build`

æ£€æŸ¥ç”Ÿæˆçš„`dist`æ–‡ä»¶æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„`sass`è¢«æˆåŠŸçš„ç¼–è¯‘æˆä¸ºäº†`css`æ–‡ä»¶å¹¶ä¸”åˆ é™¤äº†å¤šäºç©ºæ ¼(è¿›è¡Œäº†å‹ç¼©)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2e8566f4f304c77add0451401a0a9b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è¿™ä¸€æ­¥æˆ‘ä»¬`scss`çš„åŸºç¡€é…ç½®ä¹Ÿå·²ç»å®Œæˆäº†ï¼

## é…ç½®`html`é¡µé¢

å½“å‰æˆ‘ä»¬æ‰€æœ‰æ¶‰åŠçš„éƒ½æ˜¯é’ˆå¯¹å•é¡µé¢åº”ç”¨çš„é…ç½®ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿«åˆ‡éœ€è¦ä¸€ä¸ª`html`å±•ç¤ºé¡µé¢ã€‚

æ­¤æ—¶å°±å¼•å…¥æˆ‘ä»¬çš„ä¸»è§’ï¼Œæˆ‘ä»¬åç»­çš„å¤šé¡µé¢åº”ç”¨ä¹Ÿéœ€è¦æœºé‡è¿™ä¸ªæ’ä»¶ç”Ÿæˆ`html`é¡µé¢

[html-webpack-plugin](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fhtml-webpack-plugin)ï¼Œå…¶å®çœ‹åˆ°è¿™é‡Œæˆ‘ç›¸ä¿¡å¤§å®¶å¯¹è¿™ä¸ªæ’ä»¶åŸæœ¬å°±å·²ç»è€³ç†Ÿèƒ½è¯¦äº†ã€‚

> ç®€å•ä»‹ç»ä¸€ä¸‹å®ƒçš„ä½œç”¨: è¿™ä¸ªæ’ä»¶ä¸ºæˆ‘ä»¬ç”Ÿæˆ HTML æ–‡ä»¶ï¼ŒåŒæ—¶å¯ä»¥æ”¯æŒè‡ªå®šä¹‰`html`æ¨¡æ¿ã€‚

> å¤šé¡µé¢åº”ç”¨ä¸»è¦åŸºäºå®ƒçš„`chunks`è¿™ä¸ªå±æ€§é…ç½®ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆä¹°ä¸ªå…³å­ã€‚

è®©æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹è¿™ä¸ªæ’ä»¶:

```SHELL
yarn add --dev html-webpack-plugin
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`public/index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div id='root'></div>
</body>

</html>
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºæ’ä»¶çš„æ¨¡æ¿æ–‡ä»¶ï¼ŒåŒæ—¶ä¸å…¥å£æ–‡ä»¶ä¸­çš„`ReactDom.reander(...,document.getElementById('root'))`è¿›è¡Œå‘¼åº”ï¼Œåœ¨é¡µé¢åˆ›å»ºä¸€ä¸ª`id=root`çš„`div`ä½œä¸ºæ¸²æŸ“èŠ‚ç‚¹ã€‚

```js
// webpack.base.js
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  // å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œä¹‹åä¼šç€é‡å¼ºè°ƒ
  entry: {
    main: path.resolve(__dirname, '../src/packages/home/index.tsx'),
  },
  resolve: {
    alias: {
      '@src': path.resolve(__dirname, '../src'),
      '@packages': path.resolve(__dirname, '../src/packages'),
      '@containers': path.resolve(__dirname, '../src/containers'),
    },
    mainFiles: ['index', 'main'],
    extensions: ['.ts', '.tsx', '.scss', 'json', '.js'],
  },
  module: {
    rules: [
      {
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
      {
        test: /\.(sa|sc)ss$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
          },
          'css-loader',
          'postcss-loader',
          {
            loader: 'resolve-url-loader',
            options: {
              keepQuery: true,
            },
          },
          {
            loader: 'sass-loader',
            options: {
              sourceMap: true,
            },
          },
        ],
      },
      {
        test: /\.(png|jpe?g|svg|gif)$/,
        type: 'asset/inline',
      },
      {
        test: /\.(eot|ttf|woff|woff2)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[hash][ext][query]',
        },
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'assets/[name].css',
    }),
    // ç”Ÿæˆhtmlåç§°ä¸ºindex.html
    // ç”Ÿæˆä½¿ç”¨çš„æ¨¡æ¿ä¸ºpublic/index.html
    new htmlWebpackPlugin({
      filename: 'index.html',
      template: path.resolve(__dirname, '../public/index.html'),
    }),
  ],
};
å¤åˆ¶ä»£ç 
```

æ­¤æ—¶ï¼Œå½“æˆ‘ä»¬å†æ¬¡è¿è¡Œ`yarn build`æ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆçš„`dist`ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª`html`æ–‡ä»¶ï¼Œè¿™ä¸ª`html`æ–‡ä»¶ä¼šæ³¨å…¥æˆ‘ä»¬æ‰“åŒ…ç”Ÿæˆåçš„çš„`js`å’Œ`css`å†…å®¹ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3a57ff6ebe0492eb7129a9b0e1a9bba~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ‰“å¼€`index.html`ï¼Œå°±ä¼šå±•ç¤ºå‡ºæˆ‘ä»¬ä»£ç ä¸­ä¹¦å†™çš„é¡µé¢å•¦ï½

## é…ç½®å¼€å‘ç¯å¢ƒé¢„è§ˆ

ä¸Šè¾¹çš„é•¿ç¯‡å¤§è®ºå·²ç»èƒ½æ»¡è¶³ä¸€ä¸ª`SPA`å•é¡µé¢åº”ç”¨çš„æ„å»ºäº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ€»ä¸èƒ½æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½éœ€è¦æ‰§è¡Œä¸€æ¬¡æ‰“åŒ…å‘½ä»¤åœ¨é¢„è§ˆå§ã€‚

è¿™æ ·çš„è¯ä¹Ÿå¤ªè¿‡äºéº»çƒ¦äº†ï¼Œåˆ«æ‹…å¿ƒ`webpack`ä¸ºæˆ‘ä»¬æä¾›äº†`devServer`é…ç½®ï¼Œæ”¯æŒæˆ‘ä»¬æ¯æ¬¡æ›´æ–°ä»£ç **çƒ­é‡è½½**ã€‚

æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½å§ï½

é¦–å…ˆè®©æˆ‘ä»¬åœ¨`scripts`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`webpack.dev.js`æ–‡ä»¶ï¼Œè¡¨ç¤ºä¸“é—¨ç”¨äºå¼€å‘ç¯å¢ƒä¸‹çš„æ‰“åŒ…é¢„è§ˆ:

> è™½ç„¶`devServer`å·²ç»å†…ç½®äº†`hot:true`è¾¾åˆ°çƒ­é‡è½½ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦å®‰è£…`webpack-dev-server`ã€‚

```js
// webpack.dev.js
const { merge } = require('webpack-merge');
const baseConfig = require('./webpack.base');
const path = require('path');

const devConfig = {
  mode: 'development',
  devServer: {
    // staticå…è®¸æˆ‘ä»¬åœ¨DevServerä¸‹è®¿é—®è¯¥ç›®å½•çš„é™æ€èµ„æº
    // ç®€å•ç†è§£æ¥è¯´ å½“æˆ‘ä»¬å¯åŠ¨DevServeræ—¶ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨
    // è¿™ä¸ªæœåŠ¡å™¨ä¼šåŒæ—¶ä»¥static-directoryç›®å½•ä½œä¸ºè·Ÿè·¯å¾„å¯åŠ¨
    // è¿™æ ·çš„è¯å°±å¯ä»¥è®¿é—®åˆ°static/directoryä¸‹çš„èµ„æºäº†
    static: {
      directory: path.join(__dirname, '../public'),
    },
    // é»˜è®¤ä¸ºtrue
    hot: true,
    // æ˜¯å¦å¼€å¯ä»£ç å‹ç¼©
    compress: true,
    // å¯åŠ¨çš„ç«¯å£
    port: 9000,
  },
};

module.exports = merge(devConfig, baseConfig);
å¤åˆ¶ä»£ç 
```

å…³äº`devServer`çš„åŸºç¡€é…ç½®åœ¨ä»£ç ä¸­è¿›è¡Œäº†æ³¨é‡Šè®²è§£ï¼Œå½“ç„¶è¿˜å­˜åœ¨ä¸€äº›å…¶ä»–çš„`proxy`,`onlistening`ç­‰é…ç½®éœ€è¦çš„å°æœ‹å‹å¯ä»¥å»[è¿™é‡ŒæŸ¥é˜…](https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fdev-server%2F%23devserverproxy)ã€‚

> è¿™é‡Œéœ€è¦æåˆ°çš„æ˜¯`webpack-merge`è¿™ä¸ªæ’ä»¶æ˜¯åŸºäº`webpack`é…ç½®åˆå¹¶çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åŸºäº`webpack.base.js`å’Œ`webpack.dev.js`åˆå¹¶å¯¼å‡ºäº†ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚

æ¥ä¸‹é‡Œå†è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹`pacakge.json`ä¸‹çš„`scripts`å‘½ä»¤ã€‚

> `devServer`éœ€è¦ä½¿ç”¨`webpack serve`å¯åŠ¨ã€‚

```json
...
 "scripts": {
+   "dev": "webpack serve --config ./scripts/webpack.dev.js",
    "build": "webpack --config ./scripts/webpack.base.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
...
å¤åˆ¶ä»£ç 
```

æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿è¡Œ`yarn dev`å°±å¯ä»¥åœ¨`localhost:9000`è®¿é—®åˆ°æˆ‘ä»¬åˆšæ‰éœ€è¦çš„é¡µé¢å¹¶ä¸”å®æ—¶æ”¯æŒçƒ­é‡è½½äº†ã€‚

### æ”¯æŒç«¯å£è¢«å ç”¨å¯åŠ¨

è¿™é‡Œæœ‰ä¸€ä¸ªå°`tip`å½“æˆ‘ä»¬çš„`devServer`ç«¯å£è¢«å ç”¨çš„æ—¶å€™æˆ‘ä»¬å†æ¬¡å¯åŠ¨é¡¹ç›®ä¼šå› ä¸ºç›¸åŒçš„ç«¯å£è¢«å ç”¨è€ŒæŠ¥é”™

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a6e865544e043a5ac9c093f90738944~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

è§£å†³ç«¯å£å ç”¨çš„é—®é¢˜æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“[`node-portfinder`](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fportfinder)

å®ƒçš„ç”¨æ³•å¾ˆç®€ç­”æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»ä¸Šæ–¹åº“åç§»æ­¥å®˜ç½‘æ¥æŸ¥çœ‹ç”¨æ³•:

é¦–å…ˆå…ˆè®©æˆ‘ä»¬æ¥ç»™`scripts/utils/constant.js`ä¸­æ·»åŠ ä¸€ä¸ªå¸¸é‡ä¸ºå›ºå®šçš„å¯åŠ¨ç«¯å£:

```js
// scripts/utils/constant.js
...
// å›ºå®šç«¯å£
const BASE_PROT = 9000
...
module.exports = {
  MAIN_FILE,
  log,
  separator,
  BASE_PROT
}
å¤åˆ¶ä»£ç 
```

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä¸Šè¾¹çš„`webpack.dev.js`:

```js
const { merge } = require('webpack-merge')
const baseConfig = require('./webpack.base')
const portfinder = require('portfinder')
const path = require('path')
const { BASE_PROT } = require('./utils/constant')

portfinder.basePort = BASE_PROT

const devConfig = {
  mode: 'development',
  devServer: {
    // staticå…è®¸æˆ‘ä»¬åœ¨DevServerä¸‹è®¿é—®è¯¥ç›®å½•çš„é™æ€èµ„æº
    // ç®€å•ç†è§£æ¥è¯´ å½“æˆ‘ä»¬å¯åŠ¨DevServeræ—¶ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨
    // è¿™ä¸ªæœåŠ¡å™¨ä¼šåŒæ—¶ä»¥static-directoryç›®å½•ä½œä¸ºè·Ÿè·¯å¾„å¯åŠ¨
    // è¿™æ ·çš„è¯å°±å¯ä»¥è®¿é—®åˆ°static/directoryä¸‹çš„èµ„æºäº†
    static: {
      directory: path.join(__dirname, '../public'),
    },
    // é»˜è®¤ä¸ºtrue
    hot: true,
    // æ˜¯å¦å¼€å¯ä»£ç å‹ç¼©
    compress: true,
    // å¯åŠ¨çš„ç«¯å£
    port: BASE_PROT,
  },
}

module.exports = async function () {
  try {
    // ç«¯å£è¢«å ç”¨æ—¶å€™ portfinder.getPortPromise è¿”å›ä¸€ä¸ªæ–°çš„ç«¯å£(å¾€ä¸Šå åŠ )
    const port = await portfinder.getPortPromise()
    devConfig.devServer.port = port
    return merge(devConfig, baseConfig)
  } catch (e) {
    throw new Error(e)
  }
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬æŠŠå¯¼å‡ºä»å¯¹è±¡å˜æˆäº†å¯¼å‡ºä¸€ä¸ªå‡½æ•°,`webpack`ä¸­é…ç½®çš„å¯¼å‡ºæ”¯æŒä¸€ä¸ªå¯¹è±¡çš„åŒæ—¶ä¹Ÿæ”¯æŒä¸€ä¸ªå‡½æ•°ï½

ç„¶åå‡½æ•°ä¸­è°ƒç”¨`portfinder.getPortPromise()`åˆ¤æ–­å½“å‰ç«¯å£æ˜¯å¦å ç”¨ï¼Œå¦‚æœå ç”¨`portfinder`ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ç«¯å£ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹`devConfig`ä¸­çš„ç«¯å£å¹¶ä¸”è¿”å›æœ€æ–°çš„é…ç½®è¿›è¡Œå¯åŠ¨å°±å¯ä»¥äº†ï¼

è®©æˆ‘ä»¬é‡æ–°è¿è¡Œ`yarn dev`~

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8501806cfbc243a99e96b24aaaac33b0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

## åˆ‡å…¥å¤šé¡µé¢åº”ç”¨

æ¥ä¸‹æ¥æ­£å¼è¿›å…¥æˆ‘ä»¬çš„å¤šå…¥å£æ–‡ä»¶éƒ¨åˆ†è®²è§£ã€‚

### åŸç†

#### æ‹†åˆ†`js`

æ‰€è°“åŸºäº`webpack`å®ç°å¤šé¡µé¢åº”ç”¨ï¼Œç®€å•æ¥å°†å°±æ˜¯åŸºäºå¤šä¸ª`entry`ï¼Œå°†`js`ä»£ç åˆ†ä¸ºå¤šä¸ª`entry`å…¥å£æ–‡ä»¶ã€‚

æ¯”å¦‚æˆ‘åœ¨`src/packages/editor`æ–°å»ºä¸€ä¸ªå…¥å£æ–‡ä»¶`index.tsx`ï¼ŒåŒæ—¶ä¿®æ”¹`webpack`ä¸­çš„`entry`é…ç½®ä¸ºä¸¤ä¸ªå…¥å£æ–‡ä»¶ï¼Œ`webpack`å°±ä¼šåŸºäºå…¥å£æ–‡ä»¶çš„ä¸ªæ•°è‡ªåŠ¨è¿›è¡Œä¸åŒ`chunk`ä¹‹é—´çš„æ‹†åˆ†ã€‚

> ç®€å•æ¥è¯´å°±æ˜¯`webapck`ä¼šåŸºäºå…¥å£æ–‡ä»¶å»æ‹†åˆ†ç”Ÿæˆçš„`js`ä»£ç æˆä¸ºä¸€ä¸ªä¸€ä¸ª`chunk`ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad5afd17405d4032b0afaf82c6d30783~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

ä¸Šè¾¹çš„é…ç½®æˆ‘ä»¬è¿è¡Œ`yarn build`ä¹‹åç”Ÿæˆçš„`dist`ç›®å½•å¦‚ä¸‹:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ac71a3d90314ec5863ad0111cf7646b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶ç”Ÿæˆäº†ä¸¤ä»½`js`æ–‡ä»¶ï¼Œä¸€ä»½æ˜¯`main.js`ä¸€ä»½æ˜¯`editor.js`ã€‚

æˆ‘ä»¬ç¬¬ä¸€æ­¥å·²ç»å®Œæˆäº†ï¼ŒåŸºäºä¸åŒçš„å…¥å£æ–‡ä»¶æ‰“åŒ…ç”Ÿæˆä¸åŒçš„`js`ã€‚

#### æ‹†åˆ†`html`

ä½†æ˜¯ç°åœ¨æˆ‘ä»¬ç°åœ¨æ‹†åˆ†å‡ºæ¥çš„`js`è¿˜æ˜¯åœ¨åŒä¸€ä¸ª`index.html`ä¸­è¿›è¡Œå¼•å…¥ï¼Œæˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯`main.js`åœ¨`main.html`ä¸­å¼•å…¥æˆä¸ºä¸€ä¸ªé¡µé¢ã€‚

`editor.js`åœ¨`editor.html`ä¸­å¼•å…¥æˆä¸ºä¸€ä¸ªå•ç‹¬çš„é¡µé¢ã€‚

è¦å®ç°è¿™ç§åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨`html-webpack-plugin`ä¸Šåšæ‰‹è„šã€‚

ä¸çŸ¥é“å¤§å®¶è¿˜è®°ä¸è®°å¾—æˆ‘ä»¬ä¹‹å‰ç•™ä¸‹çš„`chunks`è¿™ä¸ªå…³å­ã€‚

> æ‰€è°“çš„`chunks`é…ç½®æŒ‡çš„æ˜¯ç”Ÿæˆçš„`html`æ–‡ä»¶ä»…ä»…åŒ…å«æŒ‡å®šçš„`chunks`å—ã€‚

è¿™ä¸æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„å˜›ï¼

ç°åœ¨æˆ‘ä»¬æ‰“åŒ…ç”Ÿæˆäº†ä¸¤ä»½`js`æ–‡ä»¶åˆ†åˆ«æ˜¯`editor.js`å’Œ`main.js`ï¼Œç°åœ¨æˆ‘ä»¬æƒ³ç”Ÿæˆä¸¤ä»½å•ç‹¬çš„`html`æ–‡ä»¶ï¼Œä¸¤ä¸ª`html`æ–‡ä»¶ä¸­åˆ†åˆ«å¼•å…¥ä¸åŒçš„`editor.js`å’Œ`main.js`ã€‚

æ­¤æ—¶æˆ‘ä»¬æ¯æ¬¡æ‰“åŒ…åªéœ€è¦è°ƒç”¨ä¸¤æ¬¡`htmlWebpackPlugin`ï¼Œä¸€ä»½åŒ…å«`editor`è¿™ä¸ª`chunk`ï¼Œä¸€ä»½åŒ…å«`main`è¿™ä¸ª`chunk`ä¸å°±å¯ä»¥äº†å˜›ã€‚

è®©æˆ‘ä»¬æ¥è¯•ä¸€è¯•:

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f92daafba458450c83af5573c9181a48~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œ`yarn build`æ¥çœ‹ä¸€çœ‹ç”Ÿæˆçš„æ–‡ä»¶:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4653bfd2dc9145bba2c4972958d16f74~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æ¥çœ‹çœ‹æˆ‘ä»¬ç”Ÿæˆçš„`html`å’Œ`js`ç»“æ„ï¼Œå¤§åŠŸå‘Šæˆæ²¡ä¸€ç‚¹é—®é¢˜ï¼è¿™æ ·çš„ç¡®èƒ½è§£å†³ï¼Œè¿™ä¹Ÿæ˜¯åŸºäº`webpack`æ‰“åŒ…å¤šé¡µé¢åº”ç”¨çš„åŸç†ã€‚

å¯æ˜¯å¦‚æœæˆ‘ä»¬å­˜åœ¨å¾ˆå¤šä¸ªé¡µé¢çš„è¯ï¼Œé¦–å…ˆæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å…¥å£æ–‡ä»¶ç„¶ååœ¨è¿›è¡Œæ·»åŠ ä¸€ä¸ª`htmlWebpackPlugin`è¿™æ˜¾ç„¶æ˜¯ä¸äººæ€§çš„ã€‚

åŒæ—¶å¦‚æœè¿™ä¸ªé¡¹ç›®ä¸‹æœ‰å¾ˆå¤šä¸ªå¤šé¡µåº”ç”¨ï¼Œä½†æ˜¯æˆ‘æ¯æ¬¡å¼€å‘ä»…ä»…å…³å¿ƒæŸä¸€ä¸ªåº”ç”¨è¿›è¡Œå¼€å‘ï¼Œæ¯”å¦‚æˆ‘è´Ÿè´£çš„æ˜¯`home`æ¨¡å—ï¼Œæˆ‘å¹¶ä¸æƒ³ä½¿ç”¨å’Œå…³å¿ƒ`editor`æ¨¡å—ã€‚é‚£ä¹ˆæ¯æ¬¡æˆ‘è¿˜éœ€è¦åœ¨`dev`ç¯å¢ƒä¸‹è¿›è¡Œæ‰“åŒ…å—ï¼Ÿæ˜¾ç„¶æ˜¯ä¸éœ€è¦çš„ã€‚

æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å°è¯•æ¥ä¿®æ”¹è¿™äº›é…ç½®å°†å®ƒå˜æˆè‡ªåŠ¨åŒ–ä¸”æŒ‰éœ€æ‰“åŒ…çš„å·¥ç¨‹åŒ–é…ç½®å§ã€‚

## å·¥ç¨‹åŒ–å¤šé¡µé…ç½®

### å·¥ç¨‹åŒ–åŸç†

æˆ‘ä»¬ä¹‹å‰å·²ç»è®²æ¸…æ¥šäº†`webpack`ä¸­çš„åŸç†äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®ç°çš„è¿‡ç¨‹æ˜¯:

1. æ¯æ¬¡æ‰“åŒ…é€šè¿‡`node`è„šæœ¬å»æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ã€‚
2. æ¯æ¬¡æ‰“åŒ…é€šè¿‡å‘½ä»¤è¡Œäº¤äº’å‘½ä»¤ï¼Œè¯»å–`pacakges`ä¸‹çš„ç›®å½•è®©ç”¨æˆ·é€‰æ‹©éœ€è¦æ‰“åŒ…çš„é¡µé¢ã€‚
3. å½“ç”¨æˆ·é€‰ä¸­å¯¹åº”éœ€è¦æ‰“åŒ…çš„ç›®å½•åï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥çš„æ–¹å¼åŠ¨æ€è¿›è¡Œæ‰“åŒ…ä¸åŒçš„é¡µé¢ã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¤–ç”¨åˆ°ä¸€ä¸‹å‡ ä¸ªåº“ï¼Œè¿˜ä¸å¤ªæ¸…æ¥šçš„åŒå­¦å¯ä»¥ç‚¹å‡»å»æŸ¥çœ‹ä¸€ä¸‹æ–‡æ¡£:

- [`execa`](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fexeca)

è¿™ä¸ªåº“æ”¹è¿›äº†`node`çš„æºç”Ÿæ¨¡å—`child_process`,ç”¨äºå¼€å¯ä¸€ä¸ª`node`å­è¿›ç¨‹ã€‚

- [`inquirer`](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js)

`inquirer`æä¾›ä¸€äº›åˆ—`api`ç”¨äº`nodejs`ä¸­å’Œå‘½ä»¤è¡Œçš„äº¤äº’ã€‚

- [`chalk`](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchalk%2Fchalk)

`chalk`ä¸ºæˆ‘ä»¬çš„æ‰“å°å¸¦ä¸Šä¸°å¯Œçš„é¢œè‰².

```shell
yarn add -D chalk inquirer execa      
å¤åˆ¶ä»£ç 
```

### å®ç°ä»£ç 

é¦–å…ˆè®©æˆ‘ä»¬åœ¨`scripts`ä¸‹åˆ›å»ºä¸€ä¸ª`utils`çš„æ–‡ä»¶å¤¹ã€‚

#### `utils/constant.js`

`constant.js`ä¸­å­˜æ”¾æˆ‘ä»¬å…³äºè°ƒç”¨è„šæœ¬å£°æ˜çš„ä¸€äº›å¸¸é‡:

```js
// è§„å®šå›ºå®šçš„å…¥å£æ–‡ä»¶å packages/**/index.tsx
const MAIN_FILE = 'index.tsx'
const chalk = require('chalk')

// æ‰“å°æ—¶é¢œè‰²
const error = chalk.bold.red
const warning = chalk.hex('#FFA500')
const success = chalk.green

const maps = {
  success,
  warning,
  error,
}

// å› ä¸ºç¯å¢ƒå˜é‡çš„æ³¨å…¥æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ–¹å¼è¿›è¡Œæ³¨å…¥çš„
// æ‰€ä»¥å½“ æ‰“åŒ…å¤šä¸ªæ–‡ä»¶æ—¶ æˆ‘ä»¬é€šè¿‡*è¿›è¡Œè¿æ¥ æ¯”å¦‚ homeå’Œeditor æ³¨å…¥çš„ç¯å¢ƒå˜é‡ä¸ºhome*editor
// æ³¨å…¥å¤šä¸ªåŒ…ç¯å¢ƒå˜é‡æ—¶çš„åˆ†éš”ç¬¦
const separator = '*'


const log = (message, types) => {
  console.log(maps[types](message))
}

module.exports = {
  MAIN_FILE,
  log,
  separator,
  BASE_PORT,
}
å¤åˆ¶ä»£ç 
```

#### `utils/helper.js`

```js
const path = require('path')
const fs = require('fs')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { MAIN_FILE } = require('./constant')

// è·å–å¤šé¡µé¢å…¥å£æ–‡ä»¶å¤¹ä¸­çš„è·¯å¾„
const dirPath = path.resolve(__dirname, '../../src/packages')

// ç”¨äºä¿å­˜å…¥å£æ–‡ä»¶çš„Mapå¯¹è±¡
const entry = Object.create(null)

// è¯»å–dirPathä¸­çš„æ–‡ä»¶å¤¹ä¸ªæ•°
// åŒæ—¶ä¿å­˜åˆ°entryä¸­  keyä¸ºæ–‡ä»¶å¤¹åç§° valueä¸ºæ–‡ä»¶å¤¹è·¯å¾„
fs.readdirSync(dirPath).filter(file => {
  const entryPath = path.join(dirPath, file)
  if (fs.statSync(entryPath)) {
    entry[file] = path.join(entryPath, MAIN_FILE)
  }
})

// æ ¹æ®å…¥å£æ–‡ä»¶listç”Ÿæˆå¯¹åº”çš„htmlWebpackPlugin
// åŒæ—¶è¿”å›å¯¹åº”wepbackéœ€è¦çš„å…¥å£å’ŒhtmlWebpackPlugin
const getEntryTemplate = packages => {
  const entry = Object.create(null)
  const htmlPlugins = []
  packages.forEach(packageName => {
    entry[packageName] = path.join(dirPath, packageName, MAIN_FILE)
    htmlPlugins.push(
      new HtmlWebpackPlugin({
        template: path.resolve(__dirname, '../../public/index.html'),
        filename: `${packageName}.html`,
        chunks: ['manifest', 'vendors', packageName],
      })
    )
  })
  return { entry, htmlPlugins }
}

module.exports = {
  entry,
  getEntryTemplate,
}
å¤åˆ¶ä»£ç 
```

`helper.js`ä¸­å…¶å®ä¸»è¦å¯¼å‡ºçš„`getEntryTemplate`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¾“å…¥ä¸€ä¸ª`package`çš„æ•°ç»„ï¼ŒåŒæ—¶è¿”å›å¯¹åº”`webpack`éœ€è¦çš„`entry`å’Œ`html-wepback-plugin`ç»„æˆçš„æ•°ç»„ã€‚

#### `utils/dev.js`

å½“æˆ‘ä»¬å®šä¹‰å¥½ä¸¤ä¸ªè¾…åŠ©æ–‡ä»¶ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å®ç°å’Œ"ç”¨æˆ·"äº¤äº’çš„éƒ¨åˆ†äº†ï¼Œä¹Ÿå°±æ˜¯å½“ç”¨æˆ·è°ƒç”¨æˆ‘ä»¬è¿™ä¸ªè„šæœ¬ä¹‹åã€‚

- é¦–å…ˆåŠ¨æ€è¯»å–`packages`ä¸‹çš„ç›®å½•ï¼Œè·å–å½“å‰é¡¹ç›®ä¸‹æ‰€æœ‰çš„é¡µé¢æ–‡ä»¶ã€‚
- é€šè¿‡å‘½ä»¤äº¤äº’ç½—åˆ—å½“å‰æ‰€æœ‰é¡µé¢ï¼Œæä¾›ç»™ç”¨æˆ·é€‰æ‹©ã€‚
- ç”¨æˆ·é€‰ä¸­åï¼Œé€šè¿‡`execa`è°ƒç”¨`webpack`å‘½ä»¤åŒæ—¶æ³¨å…¥ç¯å¢ƒå˜é‡è¿›è¡Œæ ¹æ®ç”¨æˆ·é€‰ä¸­å†…å®¹æ‰“åŒ…ã€‚

```js
const inquirer = require('inquirer')

const execa = require('execa')
const { log, separator } = require('./constant')
const { entry } = require('./helper')

// è·å–packagesä¸‹çš„æ‰€æœ‰æ–‡ä»¶
const packagesList = [...Object.keys(entry)]

// è‡³å°‘ä¿è¯ä¸€ä¸ª
if (!packagesList.length) {
  log('ä¸åˆæ³•ç›®å½•ï¼Œè¯·æ£€æŸ¥src/packages/*/main.tsx', 'warning')
  return
}

// åŒæ—¶æ·»åŠ ä¸€ä¸ªå…¨é€‰
const allPackagesList = [...packagesList, 'all']

// è°ƒç”¨inquirerå’Œç”¨æˆ·äº¤äº’
inquirer
  .prompt([
    {
      type: 'checkbox',
      message: 'è¯·é€‰æ‹©éœ€è¦å¯åŠ¨çš„é¡¹ç›®:',
      name: 'devLists',
      choices: allPackagesList, // é€‰é¡¹
      // æ ¡éªŒæœ€å°‘é€‰ä¸­ä¸€ä¸ª
      validate(value) {
        return !value.length ? new Error('è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¡¹ç›®è¿›è¡Œå¯åŠ¨') : true
      },
      // å½“é€‰ä¸­allé€‰é¡¹æ—¶å€™ è¿”å›æ‰€æœ‰packagesListè¿™ä¸ªæ•°ç»„
      filter(value) {
        if (value.includes('all')) {
          return packagesList
        }
        return value
      },
    },
  ])
  .then(res => {
    const message = `å½“å‰é€‰ä¸­Package: ${res.devLists.join(' , ')}`
    // æ§åˆ¶å°è¾“å…¥æç¤ºç”¨æˆ·å½“å‰é€‰ä¸­çš„åŒ…
    log(message, 'success')
    runParallel(res.devLists)
  })

// è°ƒç”¨æ‰“åŒ…å‘½ä»¤
async function runParallel(packages) {
  // å½“å‰æ‰€æœ‰å…¥å£æ–‡ä»¶
  const message = `å¼€å§‹å¯åŠ¨: ${packages.join('-')}`
  log(message, 'success')
  log('\nplease waiting some times...', 'success')
  await build(packages)
}

// çœŸæ­£æ‰“åŒ…å‡½æ•°
async function build(buildLists) {
  // å°†é€‰ä¸­çš„åŒ…é€šè¿‡separatoråˆ†å‰²
  const stringLists = buildLists.join(separator)
  // è°ƒç”¨é€šè¿‡execaè°ƒç”¨webapckå‘½ä»¤
  // åŒæ—¶æ³¨æ„è·¯å¾„æ˜¯ç›¸å¯¹ æ‰§è¡Œnodeå‘½ä»¤çš„cwdçš„è·¯å¾„ 
  // è¿™é‡Œæˆ‘ä»¬æœ€ç»ˆä¼šåœ¨package.jsonä¸­ç”¨nodeæ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬
  await execa('webpack', ['server', '--config', './scripts/webpack.dev.js'], {
    stdio: 'inherit',
    env: {
      packages: stringLists,
    },
  })
}
å¤åˆ¶ä»£ç 
```

`dev.js`ä¸­çš„é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡å‘½ä»¤è¡Œå’Œç”¨æˆ·äº¤äº’è·å¾—ç”¨æˆ·æƒ³è¦å¯åŠ¨çš„é¡¹ç›®ä¹‹åé€šè¿‡ç”¨æˆ·é€‰ä¸­çš„`packages`ç„¶åé€šè¿‡`execa`æ‰§è¡Œ`webpack`å‘½ä»¤åŒæ—¶åŠ¨æ€æ³¨å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚

æ³¨å…¥çš„ç¯å¢ƒå˜é‡æ˜¯`*`åˆ†å‰²çš„åŒ…åã€‚æ¯”å¦‚ç”¨æˆ·å¦‚æœé€‰ä¸­`app`å’Œ`editor`é‚£ä¹ˆå°±ä¼šæ³¨å…¥ä¸€ä¸ª`packages`çš„ç¯å¢ƒå˜é‡ä¸º`app*editor`ã€‚

### ä¿®æ”¹`webpack.base.js`

æˆ‘ä»¬å·²ç»å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å’Œç”¨æˆ·äº¤äº’ï¼Œå¹¶ä¸”è·å¾—ç”¨æˆ·é€‰ä¸­çš„`pacakge`ã€‚

æ­¤æ—¶æˆ‘ä»¬å°±åŸºäº`wepback.base.js`æ¥ä¿®æ”¹ï¼Œè¾¾åˆ°è¯»å–ç”¨æˆ·ç¯å¢ƒå˜é‡è¿›è¡ŒåŠ¨æ€æ‰“åŒ…çš„æ•ˆæœ:

```js
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');
const { separator } = require('./utils/constant')
const { getEntryTemplate } = require('./utils/helper')

// å°†packagesæ‹†åˆ†æˆä¸ºæ•°ç»„ ['editor','home']
const packages = process.env.packages.split(separator)

// è°ƒç”¨getEntryTemplate è·å¾—å¯¹åº”çš„entryå’ŒhtmlPlugins
const { entry, htmlPlugins } = getEntryTemplate(packages)

module.exports = {
  // åŠ¨æ€æ›¿æ¢entry
  entry,
  resolve: {
    alias: {
      '@src': path.resolve(__dirname, '../src'),
      '@packages': path.resolve(__dirname, '../src/packages'),
      '@containers': path.resolve(__dirname, '../src/containers'),
    },
    mainFiles: ['index', 'main'],
    extensions: ['.ts', '.tsx', '.scss', 'json', '.js'],
  },
  module: {
    rules: [
      {
        test: /\.(t|j)sx?$/,
        use: 'babel-loader',
      },
      {
        test: /\.(sa|sc)ss$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
          },
          'css-loader',
          'postcss-loader',
          {
            loader: 'resolve-url-loader',
            options: {
              keepQuery: true,
            },
          },
          {
            loader: 'sass-loader',
            options: {
              sourceMap: true,
            },
          },
        ],
      },
      {
        test: /\.(png|jpe?g|svg|gif)$/,
        type: 'asset/inline',
      },
      {
        test: /\.(eot|ttf|woff|woff2)$/,
        type: 'asset/resource',
        generator: {
          filename: 'fonts/[hash][ext][query]',
        },
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'assets/[name].css',
    }),
    // åŒæ—¶åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„htmlPlugins
    ...htmlPlugins
  ],
};

å¤åˆ¶ä»£ç 
```

å› ä¸ºæˆ‘ä»¬çš„ç›®å½•ç»“æ„æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¸­çš„`packages`ä¼ å…¥`getEntryTemplate`æ–¹æ³•å¯ä»¥è·å¾—å¯¹åº”çš„å…¥å£æ–‡ä»¶ï¼Œä»¥åŠç”Ÿæˆå¯¹åº”çš„`htmlWebpackPlugin`ã€‚

åˆ°è¿™ä¸€æ­¥å…¶å®æˆ‘ä»¬å·²ç»å®ç°äº†åŠ¨æ€æ‰“åŒ…çš„æ‰€æœ‰é€»è¾‘äº†ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥æ›¿æ¢ä¸€ä¸‹`package.json`ä¸­çš„è„šæœ¬

### ä¿®æ”¹`package.json`

```json
 "scripts": {
 -  "dev": "webpack serve --config ./scripts/webpack.dev.js",
 +  "dev": "node ./scripts/utils/dev.js",
    "build": "webpack --config ./scripts/webpack.base.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬å°†`dev`å‘½ä»¤æ›¿æ¢æˆä¸ºæ‰§è¡Œ`scripts/utils/dev.js`ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹è¿è¡Œ`yarn dev`:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/668a8037fec44defab88d75449211d6b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

æˆ‘ä»¬é€‰ä¸­`home`è¿›è¡Œæ‰“åŒ…:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7f813fcd3ac4ab3a1d2172d7594ddcd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51f1fecfd9b444009ce6854a75ae5195~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

å¯ä»¥çœ‹åˆ°è¿™æ¬¡ç”Ÿæˆçš„æ‰“åŒ…ç»“æœå°±çœŸçš„åªæœ‰`home.html`å’Œ`home.js`ç›¸å…³çš„å†…å®¹äº†ï¼Œè®©æˆ‘ä»¬æ‰“å¼€`localhost:9000/home.html`å¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šå‡ºç°äº†æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï½

æ­¤æ—¶å°è¯•å»è®¿é—®`http://localhost:9000/editor.html`ä¼šå¾—åˆ°`Cannot GET /editor.html`ã€‚

è¿™ä¸€æ­¥æˆ‘ä»¬å¤§åŠŸå‘Šæˆå•¦ï½ä½†æ˜¯å½“å‰åªæœ‰`dev`ç¯å¢ƒä¸‹ï¼Œè®©æˆ‘ä»¬æ¥ä¸‹æ¥æ¥æ”¹é€ `production`ç¯å¢ƒä¸‹çš„é…ç½®ã€‚

## æ”¹é€ `production`ç¯å¢ƒ

`production`ç¯å¢ƒçš„ä»£ç å’Œ`dev`ç¯å¢ƒçš„æµç¨‹æ€è·¯æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œåªæ˜¯é’ˆå¯¹äº`webpack`é…ç½®æœ‰æ‰€ä¸åŒã€‚

æ‰€ä»¥æˆ‘ä»¬åœ¨`scripts`æ–°å»ºä¸€ä¸ª`webpack.prod.js`æ–‡ä»¶:

```js
// è¿™é‡Œæˆ‘ä½¿ç”¨äº†é»˜è®¤çš„`webpack`productionä¸‹çš„é…ç½®
// å¦‚æœä½ éœ€è¦é¢å¤–çš„é…ç½®ï¼Œå¯ä»¥é¢å¤–æ·»åŠ é…ç½®ã€‚
// è¿™é‡Œæä¾›åŠ¨æ€å¤šé¡µåº”ç”¨çš„æµç¨‹ å…·ä½“å‹ç¼©/ä¼˜åŒ–æ’ä»¶å’Œé…ç½® å„ä½å°å“¥å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹é…ç½®ï½
// ä¹‹åæˆ‘ä¹Ÿä¼šåœ¨æ–‡ç« å¼€å¤´çš„githubä»“åº“ä¸­æä¾›ä¸åŒbranchå»å®è·µæœ€ä½³jsä»£ç å‹ç¼©ä¼˜åŒ–
const path = require('path')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const FriendlyErrorsWebpackPlugin = require('friendly-errors-webpack-plugin')
const { merge } = require('webpack-merge')
const baseConfig = require('./webpack.base')

const prodConfig = {
  mode: 'production',
  devtool: 'source-map',
  output: {
    filename: 'js/[name].js',
    path: path.resolve(__dirname, '../dist'),
  },
  plugins: [
    new CleanWebpackPlugin(),
    new FriendlyErrorsWebpackPlugin()
  ]
}

module.exports = merge(prodConfig, baseConfig)
å¤åˆ¶ä»£ç 
```

`scripts/build.js`ï¼Œè¿™é‡Œå’Œ`dev`ä¸‹çš„æ€è·¯æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå…¬ç”¨ä»£ç é€»è¾‘å…¶å®å¯ä»¥æ‹†åˆ†ï½

```js
const inquirer = require('inquirer')
const execa = require('execa')
const { log, separator } = require('./constant')
const { entry } = require('./helper')

const packagesList = [...Object.keys(entry)]

if (!packagesList.length) {
  log('ä¸åˆæ³•ç›®å½•ï¼Œè¯·æ£€æŸ¥src/packages/*/main.tsx', 'warning')
  return
}
const allPackagesList = [...packagesList, 'all']

inquirer
  .prompt([
    {
      type: 'checkbox',
      message: 'è¯·é€‰æ‹©éœ€è¦æ‰“åŒ…çš„é¡¹ç›®:',
      name: 'buildLists',
      choices: allPackagesList, // é€‰é¡¹
      validate(value) {
        return !value.length ? new Error('è‡³å°‘é€‰æ‹©ä¸€ä¸ªå†…å®¹è¿›è¡Œæ‰“åŒ…') : true
      },
      filter(value) {
        if (value.includes('all')) {
          return packagesList
        }
        return value
      },
    },
  ])
  .then(res => {
    // æ‹¿åˆ°æ‰€æœ‰ç»“æœè¿›è¡Œæ‰“åŒ…
    const message = `å½“å‰é€‰ä¸­Package: ${res.buildLists.join(' , ')}`
    log(message, 'success')
    runParallel(res.buildLists)
  })

function runParallel(packages) {
  const message = `å¼€å§‹æ‰“åŒ…: ${packages.join('-')}`
  log(message, 'warning')
  build(packages)
}

async function build(buildLists) {
  const stringLists = buildLists.join(separator)
  await execa('webpack', ['--config', './scripts/webpack.prod.js'], {
    stdio: 'inherit',
    env: {
      packages: stringLists,
    },
  })
}
å¤åˆ¶ä»£ç 
```

è¿™ä¸€æ­¥å…¶å®æˆ‘ä»¬å·²ç»å®Œæˆäº†åŠ¨æ€å¤šé¡µåº”ç”¨çš„å®ç°äº†ï¼ŒåŸç†éƒ¨åˆ†ä¹‹å‰ä¹Ÿå·²ç»è®²æ¸…æ¥šäº†ã€‚

å…¶å®æ ¸å¿ƒå°±æ˜¯æŠŠæˆ‘ç¯å¢ƒå˜é‡é€šè¿‡`execa`å’Œ`inquirer`è¿›è¡Œå‘½ä»¤è¡Œäº¤äº’åŠ¨æ€æ³¨å…¥ç¯å¢ƒå˜é‡æ‰“åŒ…å¯¹åº”é€‰ä¸­æ–‡ä»¶ã€‚

> å¦‚æœå¯¹`webpack`ä¸­ç¯å¢ƒå˜é‡è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç‚¹å‡»è¿™ç¯‡æ–‡ç« ï¼Œ[Wepbackä¸­ç¯å¢ƒå˜é‡çš„å„ç§å§¿åŠ¿](https://juejin.cn/post/7009996033639841800)ã€‚

## `Eslint` & `prettier`

å®Œæˆäº†æ ¸å¿ƒçš„åº”ç”¨æµç¨‹æ‰“åŒ…ä»£ç ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥èŠä¸€äº›è½»æ¾çš„ä»£ç æ£€æŸ¥ã€‚

ä¸€ä»½è‰¯å¥½çš„å·¥ç¨‹æ¶æ„ä»£ç è§„èŒƒæ£€æŸ¥æ˜¯å¿…ä¸å¯å°‘çš„é…ç½®ã€‚

### `prettier`

```shell
yarn add --dev --exact prettier
å¤åˆ¶ä»£ç 
```

å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹:

```shell
echo {}> .prettierrc.js
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬æ¥ä¸ªè¿™ä¸ª`js`å†…å®¹æ·»åŠ ä¸€äº›åŸºç¡€é…ç½®

```js
module.exports = {
  printWidth: 100, // ä»£ç å®½åº¦å»ºè®®ä¸è¶…è¿‡100å­—ç¬¦
  tabWidth: 2, // tabç¼©è¿›2ä¸ªç©ºæ ¼
  semi: false, // æœ«å°¾åˆ†å·
  singleQuote: true, // å•å¼•å·
  jsxSingleQuote: true, // jsxä¸­ä½¿ç”¨å•å¼•å·
  trailingComma: 'es5', // å°¾éšé€—å·
  arrowParens: 'avoid', // ç®­å¤´å‡½æ•°ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨()
  htmlWhitespaceSensitivity: 'css', // htmlç©ºæ ¼æ•æ„Ÿåº¦
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬å†æ¥æ·»åŠ ä¸€ä»½`.prettierignore`è®©`prettier`å¿½ç•¥æ£€æŸ¥ä¸€äº›æ–‡ä»¶:

```
//.prettierignore 
**/*.min.js
**/*.min.css

.idea/
node_modules/
dist/
build/
å¤åˆ¶ä»£ç 
```

åŒæ—¶è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ä»£ç åŸºäº`husky`å’Œ`lint-staged`æ·»åŠ `git hook`

å…·ä½“é…ç½®å¯ä»¥å‚ç…§è¿™é‡Œ[`husky&list-staged`](https://link.juejin.cn?target=https%3A%2F%2Fprettier.io%2Fdocs%2Fen%2Fprecommit.html%23option-1-lint-stagedhttpsgithubcomokonetlint-staged)

å®‰è£…å®Œæˆåï¼Œåœ¨æˆ‘ä»¬æ¯æ¬¡`commit`æ—¶å€™éƒ½ä¼šè§¦å‘`lit-staged`è‡ªåŠ¨ä¿®å¤æˆ‘ä»¬åŒ¹é…çš„æ–‡ä»¶:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dbaed2dcf7e40d4b382399547e173b3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

å› ä¸ºæˆ‘ä»¬é¡¹ç›®ä¸­æ˜¯`ts`æ–‡ä»¶ï¼Œæ‰€ä»¥è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä»–æ”¯æŒçš„åç¼€æ–‡ä»¶:

```json
// package.json
...
  "lint-staged": {
    "*.{js,css,md,ts,tsx,jsx}": "prettier --write"
  }
...
å¤åˆ¶ä»£ç 
```

### `ESlint`

`Eslint`å…¶å®å°±ä¸ç”¨å¤šè¯´äº†ï¼Œå¤§åé¼é¼å˜›ã€‚

```js
yarn add eslint --dev
å¤åˆ¶ä»£ç 
```

åˆå§‹åŒ–`eslint`

```
npx eslint --init
å¤åˆ¶ä»£ç 
```

`eslint`å›å’Œæˆ‘ä»¬è¿›è¡Œä¸€äº›åˆ—çš„äº¤äº’æç¤ºï¼ŒæŒ‰ç…§æç¤ºè¿›è¡Œé€‰æ‹©æˆ‘ä»¬éœ€è¦çš„é…ç½®å°±å¯ä»¥äº†:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f147de3a7ac41bb860673adad7e6b96~tplv-k3u1fbpfcp-zoom-in-crop-mark:1434:0:0:0.awebp?)

> å½“`prettier`å’Œ`eslint`å…±åŒå·¥ä½œæ—¶ï¼Œä»–ä»¬å¯èƒ½ä¼šå†²çªã€‚æˆ‘ä»¬éœ€è¦å®‰è£…`yarn add -D eslint-config-prettie`æ’ä»¶å¹¶ä¸”è¦†ç›–`eslint`éƒ¨åˆ†è§„åˆ™ã€‚

å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹`eslint`çš„é…ç½®æ–‡ä»¶,è®©å†²çªæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨`prettier`è¦†ç›–`eslint`è§„åˆ™:

```js
// .eslint.js
module.exports = {
    "env": {
        "browser": true,
        "es2021": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:react/recommended",
        "plugin:@typescript-eslint/recommended",
        // æ·»åŠ `prettier`æ‹“å±• ç”¨äºå’Œ`prettier`å†²çªæ—¶è¦†ç›–`eslint`è§„åˆ™
        "prettier"
    ],
    "parser": "@typescript-eslint/parser",
    "parserOptions": {
        "ecmaFeatures": {
            "jsx": true
        },
        "ecmaVersion": 12,
        "sourceType": "module"
    },
    "plugins": [
        "react",
        "@typescript-eslint"
    ],
    "rules": {
    }
};
å¤åˆ¶ä»£ç 
```

åŒæ—¶æˆ‘ä»¬æ¥æ·»åŠ `.eslintignore`å¿½ç•¥æ‰ä¸€äº›æˆ‘ä»¬çš„é`ts`ç›®å½•æ–‡ä»¶ï¼Œæ¯”å¦‚æ„å»ºçš„ä¸€äº›è„šæœ¬æ–‡ä»¶ã€‚

```
*.d.ts
scripts/**
å¤åˆ¶ä»£ç 
```

## å†™åœ¨æœ€å

å…³äº [Pages](https://link.juejin.cn?target=undefined) ,æ¬¢è¿å¤§å®¶åœ¨ç•™è¨€åŒºç•™ä¸‹è‡ªå·±çš„æ„è§æŒ‡å‡ºå¯¹æ–‡ç« ä¸­çš„ä¸è¶³ã€‚

ç›¸ä¿¡æ–‡ç« ä¸­çš„ä»£ç è¿˜æœ‰å¾ˆå¤šä¼˜åŒ–çš„ç‚¹ï¼Œè¿™é‡Œæä¾›ç»™å¤§å®¶çš„ä¸»è¦æ˜¯ä¸€ä¸ªæµç¨‹ã€‚

å¸Œæœ›å¤§å®¶åœ¨è¯„è®ºåŒºç•™ä¸‹å¯¹äºä»£ç ä¸­å­˜åœ¨çš„ä¸è¶³ï¼Œæˆ–è€…å¯ä»¥æŒç»­ä¼˜åŒ–ç‚¹çš„ã€‚æˆ‘ä»¬å…±åŒæ¢è®¨ğŸ˜Šï¼

åç»­å¦‚æœæœ‰æ—¶é—´æˆ‘ä¼šå°†[Pages](https://link.juejin.cn?target=undefined) æŒç»­å®Œå–„ç„¶åé›†æˆåˆ°æˆ‘`cli`ä¸­å»ï¼ŒæœŸå¾…å’Œå¤§å®¶åˆ†äº«`cli`éƒ¨åˆ†çš„`pages`~



ä½œè€…ï¼š19ç»„æ¸…é£
é“¾æ¥ï¼šhttps://juejin.cn/post/7011128931533193230
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚